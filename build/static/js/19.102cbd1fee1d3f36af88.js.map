{"version":3,"sources":["webpack:///src/components/list/invented/invented.vue","webpack:///./src/components/list/invented/invented.vue?46ea","webpack:///./src/components/list/invented/invented.vue"],"names":["invented","edit","cityId","CollectorNum","consumerUname","deviceNumber","districtDetail","districtId","districtSite","houseNumber","latitude","longitude","provinceId","telephone","type","val","id","_this","this","then","res","water","data","$message","message","JSON","parse","length","searchData","catch","_this2","eid","index","_this3","refresh","_","finishPullDown","errorList","waterOrign","_this5","err","_this6","push","extends_default","trueId","getTime","result","meters","setup","_this7","action","_this8","_ref","value","_this9","list","remark","ind","resolve","_this10","inventWrapper","invented_invented","render","_vm","_h","$createElement","_c","_self","attrs","staticClass","size","on","click","offlineSetUp","_v","creatVirtual","ref","directives","name","rawName","expression","accordion","change","handleChange","model","callback","$$v","activeName","_l","item","key","slot","_s","$event","stopPropagation","replace","remove","addEquip","staticStyle","padding-left","width","row-class-name","row","offline","selection-change","handleSelectionChange","prop","label","scopedSlots","_u","fn","text-align","deleteWater","$refs","edition","show","listDate","_e","title","visible","dialogVisible","update:visible","placeholder","confirm","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/19.102cbd1fee1d3f36af88.js","sourcesContent":["<template>\r\n  <div id=\"invented\">\r\n    <div class=\"opera\">\r\n        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"offlineSetUp\">离线录入</el-button>\r\n        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"creatVirtual\" >添加采集器</el-button>\r\n    </div>\r\n    <div class=\"cloWra\" ref=\"inventWrapper\">\r\n        <div>\r\n            <el-collapse  accordion class=\"elist\" v-loading=\"freshData\" v-model=\"activeName\" @change=\"handleChange\">\r\n                <el-collapse-item  :name=\"item.id\" v-for=\"(item,index) in listDate\" :key=\"item.ind\" >\r\n                    <template slot=\"title\">\r\n                            <div class=\"invtitle\">\r\n                                <p>编号：{{item.id}}</p>\r\n                                <div>\r\n                                    <span class=\"replace\" @click.stop=\"replace(item.id,item,index)\">替换</span> \r\n                                    <span class=\"remove\"  @click.stop=\"remove(item.id)\" >删除</span>\r\n                                </div> \r\n                            </div>\r\n                    </template>\r\n                    \r\n                    <div class=\"item-opera\">\r\n                        <p class=\"tip\">备注：{{item.remark}}</p>\r\n                        \r\n                        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"addEquip\">水表录入</el-button>\r\n\r\n                        \r\n                    </div>\r\n                    <p style=\"padding-left:15px;\">当前录入数量：{{item.list.length}}</p>\r\n                    <el-table\r\n                    :data=\"item.list\"\r\n                    @selection-change=\"handleSelectionChange\"\r\n                    :row-class-name=\"({row})=>row.offline&&'offline'\"\r\n                    style=\"width: 100%\">\r\n                        <el-table-column\r\n                            prop=\"deviceNumber\"\r\n                            label=\"设备编号\"\r\n                        >\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                            prop=\"houseNumber\"\r\n                            label=\"设备位置\"\r\n                            >\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                            prop=\"setupDatetime\"\r\n                            label=\"录入时间\"\r\n                            >\r\n                        </el-table-column>\r\n                        <el-table-column\r\n                        label=\"操作\"\r\n                        >\r\n                        <template slot-scope=\"water\" >\r\n                            <div style=\"text-align:center\" >\r\n                                <el-button size=\"mini\" type=\"text\" @click=\"deleteWater(item.list,water.row.deviceNumber,water.row,water)\">删除</el-button> <span></span>\r\n                                <el-button size=\"mini\" type=\"text\" @click=\"$refs.edition.show(water.row)\">详情</el-button>\r\n\r\n                            </div>\r\n                        </template>\r\n                        </el-table-column>\r\n                    </el-table>\r\n                    \r\n                </el-collapse-item>\r\n            </el-collapse>\r\n            <div class=\"origintip\" v-if=\"this.listDate.length==0\">\r\n                <i class=\"el-icon-warning\"></i>\r\n                <span>您还未创建虚拟采集器,点击右上角添加创建虚拟采集器</span>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <el-dialog\r\n        title=\"提示\"\r\n        :visible.sync=\"dialogVisible\"\r\n        width=\"30%\">\r\n        <span>请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除</span>\r\n        <br><br>\r\n        <div>\r\n            虚拟采集器ID：{{id}}\r\n        </div>\r\n        <div id=\"remarks\">\r\n            新的设备ID<el-input v-model=\"trueId\" placeholder=\"请输入ID\"></el-input>\r\n        </div>\r\n        <span slot=\"footer\" class=\"dialog-footer\">\r\n            <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n            <el-button type=\"primary\" @click =\"confirm(trueId)\">确 定</el-button>\r\n        </span>\r\n    </el-dialog>\r\n\r\n    <edit ref=\"edition\" ></edit>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\nconst PAGESIZE = 10  //每页显示数量\r\n\r\nimport BScroll from 'better-scroll'\r\nimport edit from '@/components/list/coloterManage/edit.vue'\r\nimport {removeStorage} from '@/assets/js/offline.js'\r\nexport default {\r\n  components:{\r\n      edit\r\n  },\r\n  props:{},\r\n  data(){\r\n    return {\r\n        activeName:'',\r\n        freshData:false,\r\n        marks:\"备注\",\r\n        id:'',          //当前选择的虚拟设备ID\r\n        trueId:'',\r\n        listDate:[],\r\n        dialogVisible: false,\r\n        tableData: [],\r\n        multipleSelection: [],\r\n        inventSCroll:null,\r\n        data:[\r\n            {\"cityId\":383,\"CollectorNum\":\"19110722\",\"consumerUname\":\"\",\"deviceNumber\":\"1509800029\",\"districtDetail\":\"钱江路-\",\"districtId\":3234,\"districtSite\":\"\",\"houseNumber\":\"101\",\"latitude\":30.25924446,\"longitude\":120.21937542,\"provinceId\":31,\"telephone\":\"\",\"type\":3},\r\n            {\"cityId\":383,\"CollectorNum\":\"19110722\",\"consumerUname\":\"\",\"deviceNumber\":\"1509800068\",\"districtDetail\":\"钱江路-\",\"districtId\":3234,\"districtSite\":\"\",\"houseNumber\":\"102\",\"latitude\":30.25924446,\"longitude\":120.21937542,\"provinceId\":31,\"telephone\":\"\",\"type\":3}\r\n            ]\r\n    }\r\n  },\r\n  watch:{},\r\n  computed:{\r\n      \r\n  },\r\n  methods:{\r\n      handleChange(val){\r\n          this.id = val\r\n      },\r\n      handleSelectionChange(val) {    //选择水表\r\n        this.multipleSelection = val;\r\n      },\r\n      addEquip(){\r\n          this.$router.push({\r\n              path:\"/watermeter\",\r\n              query:{inventedID:this.id}\r\n              })\r\n      },\r\n      offlineSetUp(){\r\n          this.water.forEach(val=>{\r\n              val.collectorNum = val.CollectorNum\r\n          }) \r\n          this.$confirm('是否导入所有离线设备','提示',{\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            })\r\n          .then(res=>{\r\n              if(this.water.length>0){\r\n                  this.$http.post('/weiXin/api/v1/deviceManager/bashGeneralInstall',\r\n                      this.water\r\n                  ,{\r\n                        'Content-Type': 'application/json;'\r\n                    },true)\r\n                  .then(res=>{\r\n                      if(res){\r\n                        //   removeStorage('watermeter',this.water)\r\n                        \r\n                          if(res.data.data){\r\n                            localStorage.setItem('watermeter',res.data.data)\r\n                            this.$message(\r\n                              {type:'success',message:`${JSON.parse(res.data.data).length}个设备导入失败`}\r\n                            )\r\n                          }else{\r\n                              this.$message(\r\n                              {type:'success',message:'导入成功'}\r\n                              )\r\n                          }\r\n                          \r\n                          this.searchData()\r\n                      }\r\n                  })\r\n\r\n              }else{\r\n                  this.$message(\r\n                        {type:'error',message:'暂无离线设备'}\r\n                    )\r\n              }\r\n          })\r\n          .catch(()=>{\r\n              \r\n          })\r\n          \r\n      },\r\n      deleteWater(table,id,row,water){\r\n        this.$confirm('是否删除水表 ' ,'提示',{\r\n        confirmButtonText: '确定',\r\n        cancelButtonText: '取消',\r\n\t\t})\r\n\t\t.then(() => {\r\n            if(row.offline){\r\n                removeStorage('watermeter',id)\r\n                table.splice(water.$index,1)\r\n                this.$message({\r\n                type: 'success',\r\n                message: '删除成功!'\r\n                });\r\n            }else{\r\n                this.$http.get('/weiXin/api/v1/deviceMend/deleteDevice',{\r\n                  deviceNum:id,\r\n                  deviceType:3\r\n                })\r\n                .then(res=>{\r\n                    \r\n                    if(res){\r\n                        table.forEach((item,ind)=>{\r\n              \r\n                            if(item.deviceNumber==id){\r\n                                table.splice(ind,1)\r\n                            }\r\n                                \r\n                        })\r\n                        this.$message({\r\n                        type: 'success',\r\n                        message: '删除成功!'\r\n                        });\r\n                    }\r\n                })\r\n\r\n            }\r\n\r\n            \r\n\t\t})\r\n\t\t.catch(() => {  \r\n\t\t})\r\n          \r\n      },\r\n      replace(eid,item,index){\r\n          this.dialogVisible = true\r\n          this.id = eid\r\n          this.replaceIndex = index\r\n      },\r\n      initScroll(Obj,SCobj){\r\n          if( !Obj ){\r\n           Obj = new BScroll(SCobj,{\r\n               click:true,\r\n               pullDownRefresh:{\r\n                threshold: 55,\r\n                txt:'刷新'\r\n                },\t\t\t   \r\n            })\r\n            Obj.on('pullingDown',()=>{\r\n                this.searchData()\r\n                .then(_=>{\r\n                    Obj.refresh()\r\n                    Obj.finishPullDown();\r\n                })\r\n                    \r\n             \r\n            })\r\n\t\t  }else{\r\n\t\t\t  Obj.refresh()\r\n          }\r\n          \r\n        },\r\n      installWater(waterOrign,result){ //返回失败的水表\r\n          return this.$http.post('/weiXin/api/v1/deviceManager/bashGeneralInstall',result,{\r\n                'Content-Type': 'application/json;'\r\n            },true)\r\n            .then(res=>{\r\n                if(res){\r\n                    if(res.data.data){\r\n                        var errorList = JSON.parse(res.data.data)\r\n                        errorList.forEach(e=>{\r\n                            e.CollectorNum = this.id\r\n                        })\r\n                       waterOrign=waterOrign.concat(errorList)\r\n                       localStorage.setItem('watermeter',JSON.stringify(waterOrign))\r\n                       this.water = waterOrign\r\n                       return  errorList\r\n                    }else{\r\n                        return []\r\n                    }\r\n                    \r\n                }\r\n            })\r\n      },\r\n      setup(){\r\n          this.$http.get('/weiXin/api/v1/virtualDevice/replaceVirtualCollectorNum',{deviceNumber:this.trueId,virtualCollectorId:this.id})\r\n            .then(res=>{\r\n                if(res.data.code==0){\r\n                    this.$message({\r\n                            type: 'success',\r\n                            message: \"替换成功\"\r\n                        })\r\n                    this.listDate.splice(this.replaceIndex,1)\r\n                    this.dialogVisible=false\r\n                    \r\n                }else{\r\n                    this.dialogVisible=false\r\n                    this.$message({\r\n                        type: 'error',\r\n                        message:res.data.message\r\n                        })\r\n                }\r\n            })\r\n            .catch(err=>{\r\n                this.dialogVisible=false\r\n            })\r\n      },\r\n      confirm(trueId){\r\n          if(this.water.length>0){//有离线设备\r\n                let waterOrign =JSON.parse(JSON.stringify(this.water))//缓存原始数据\r\n                var result = []\r\n\r\n                waterOrign = waterOrign.filter(val=>{//获取其中该采集器下的水表\r\n                    if(val.CollectorNum == this.id){\r\n                        result.push(\r\n                            {\r\n                            ...val,\r\n                            \"collectorNum\": this.trueId,\r\n                            \"type\": 3,\r\n                            'time':new Date().getTime()\r\n                            }\r\n                        ) \r\n                        return false\r\n                    }else{\r\n                        return true\r\n                    }\r\n                })\r\n                if(result.length>0){\r\n                    this.installWater(waterOrign,result)\r\n                    .then(meters=>{\r\n                        if(meters.length == 0){ //没有失败的水表\r\n                            this.setup()\r\n                            localStorage.setItem('watermeter',JSON.stringify(waterOrign)) //删除成功的水表并更新            \r\n                        }else{\r\n                            this.searchData()\r\n                            this.$message({\r\n                                type: 'error',\r\n                                message: \"部分水表安装失败\"\r\n                            })\r\n                            this.dialogVisible=false\r\n                        }\r\n                    })\r\n\r\n                }\r\n\r\n          }else{\r\n              this.setup()\r\n          }\r\n          \r\n      },\r\n      remove(id) {\r\n        this.$confirm('是否删除虚拟机？', '确认信息', {\r\n          distinguishCancelAndClose: true,\r\n          confirmButtonText: '确认',\r\n          cancelButtonText: '取消'\r\n        })\r\n          .then(() => {\r\n              \r\n            this.$http.get('/weiXin/api/v1/virtualDevice/deleteVirtualCollectorNum',{virtualCollectorId:id})\r\n            .then(res=>{\r\n                if(res.data.code==0){\r\n                    this.listDate.forEach((val,ind)=>{\r\n                        if(val.id==id){\r\n                            this.listDate.splice(ind,1)\r\n                        }\r\n                    })\r\n                    \r\n                }else if(res.data.code==24){\r\n                    this.$message({\r\n                        type:'error',\r\n                        message:'该设备下仍挂接水表不能删除,请点击替换设备'\r\n                    })\r\n                }else{\r\n                    this.$message({\r\n                        type:'error',\r\n                        message:'删除失败'\r\n                    })\r\n                }\r\n            })\r\n          })\r\n          .catch(action => {\r\n            // this.$message({\r\n            //   type: 'info',\r\n            //   message: action === 'cancel'\r\n            //     ? '已取消删除'\r\n            //     : '删除成功'\r\n            // })\r\n          });\r\n      },\r\n\r\n      creatVirtual() {\r\n        this.$prompt('请输入备注信息', '添加采集器', {\r\n            confirmButtonText: '确定',\r\n            cancelButtonText: '取消',\r\n            inputValidator:function(res){\r\n                if(res==null){\r\n                    return false\r\n                }\r\n            },\r\n            inputErrorMessage:'请输入备注'\r\n        }).then(({ value }) => {\r\n            this.$http.get('/weiXin/api/v1/virtualDevice/getVirtualCollectorNum',{remark:value})\r\n            .then(res=>{\r\n                if(res.data.code==0){\r\n                    this.listDate.push({\r\n                        id:res.data.data,\r\n                        remark:value,\r\n                        list:[],\r\n                        ind:Math.random(10)\r\n                    })\r\n\r\n                }else{\r\n                    this.$message({\r\n                        type:'info',\r\n                        message:'添加失败'\r\n                    })\r\n                }\r\n            })\r\n        }).catch(() => {\r\n            // this.$message({\r\n            // type: 'info',\r\n            // message: '取消输入'\r\n            // });       \r\n        });\r\n      },\r\n      //获取数据\r\n      searchData(){\r\n        this.water = localStorage.getItem('watermeter')?JSON.parse(localStorage.getItem('watermeter')):[] //缓存的离线水表数据\r\n        return new Promise(resolve=>{\r\n            this.freshData=true\r\n            this.$http.get('/weiXin/api/v1/virtualDevice/getAllVirtualCollectorNum',{\r\n                pageNum:1,\r\n                pageSize:200,//懒得做分页\r\n            })\r\n            .then(res=>{\r\n                this.freshData=false\r\n                \r\n                let list = res.data.data.map((val,ind)=>{\r\n                    let list = val.list\r\n                    this.water&&this.water.forEach(water=>{\r\n                        if(water.CollectorNum == val.id){\r\n                            water.offline = true\r\n                            list.push(water)\r\n                        }\r\n                    })\r\n                    return{\r\n                    id:val.id,\r\n                    remark:val.remark,\r\n                    list:list,\r\n                    ind:ind\r\n                }\r\n                    \r\n                })\r\n                this.listDate=list\r\n                \r\n                resolve()\r\n            })\r\n        })\r\n      },\r\n  },\r\n  created(){\r\n      this.searchData();\r\n  },\r\n  mounted(){\r\n      \r\n      this.$nextTick(()=>{\r\n            this.initScroll(this.inventScroll,this.$refs.inventWrapper);\r\n        });\r\n  }\r\n}\r\n</script>\r\n<style  lang=\"less\">\r\n\r\n    #invented{\r\n        .cloWra{\r\n            height: 78vh;\r\n            overflow:hidden;\r\n            >div{\r\n                min-height: calc(100% + 1px)\r\n            }\r\n        }\r\n        .elist{\r\n            margin-bottom: 50px;\r\n            .el-collapse-item__header{\r\n                height: 40px;\r\n                line-height: 40px;\r\n                display: flex;\r\n                justify-content: space-between;\r\n                .invtitle{\r\n                    display: flex;\r\n                    justify-content: space-between;\r\n                    padding:0 15px;\r\n                    width: 90%;\r\n                    order: -1;\r\n                    .remove{\r\n                        color: #b4aeae;\r\n                        margin: 15px 40px 0 15px;\r\n                        height: 15px;\r\n                        padding-left:  15px;\r\n                        border-left: 1px solid #b8b3b3;\r\n                    }\r\n                    .replace{\r\n                        color: #FC5B3B;\r\n                        margin: 15px 0px 0 15px;\r\n                        height: 15px;\r\n                        padding-left:  15px;\r\n                    }\r\n                    \r\n                }   \r\n            }\r\n            .offline{\r\n                color: red;\r\n            }\r\n                \r\n        }\r\n        .opera{\r\n                padding: 0 20px 10px 20px;\r\n                display: flex;\r\n                justify-content: flex-end;\r\n                align-items: center;\r\n                button{\r\n                    border:0;\r\n                }\r\n                .add{\r\n                    background: #FC5B3B;\r\n                }\r\n            }\r\n        .item-opera{\r\n            display: flex;\r\n            justify-content: space-between;\r\n            margin: 0 15px;\r\n            .tip{\r\n                line-height: 25px;\r\n                text-align: left;\r\n                width: 40%;\r\n                white-space:pre-wrap;\r\n                word-wrap : break-word ;\r\n                overflow: hidden ;\r\n                // padding:0 20px 10px  15px;\r\n                \r\n            }\r\n            button{\r\n                \r\n            }\r\n        }\r\n        .origintip{\r\n            margin: 20px;\r\n            text-align: center;\r\n            font-size:19px;/* no*/ \r\n        }\r\n        .el-collapse-item__content{\r\n            .opera{\r\n                margin-top: 20px;\r\n                padding: 0 20px 0 20px;\r\n                display: flex;\r\n                justify-content: space-between;\r\n                button{\r\n                    border:0;\r\n                }\r\n                .add{\r\n                    background: #FC5B3B;\r\n                }\r\n            }\r\n        }\r\n        \r\n    }\r\n\r\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/list/invented/invented.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"invented\"}},[_c('div',{staticClass:\"opera\"},[_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.offlineSetUp}},[_vm._v(\"离线录入\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.creatVirtual}},[_vm._v(\"添加采集器\")])],1),_vm._v(\" \"),_c('div',{ref:\"inventWrapper\",staticClass:\"cloWra\"},[_c('div',[_c('el-collapse',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.freshData),expression:\"freshData\"}],staticClass:\"elist\",attrs:{\"accordion\":\"\"},on:{\"change\":_vm.handleChange},model:{value:(_vm.activeName),callback:function ($$v) {_vm.activeName=$$v},expression:\"activeName\"}},_vm._l((_vm.listDate),function(item,index){return _c('el-collapse-item',{key:item.ind,attrs:{\"name\":item.id}},[_c('template',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_c('div',{staticClass:\"invtitle\"},[_c('p',[_vm._v(\"编号：\"+_vm._s(item.id))]),_vm._v(\" \"),_c('div',[_c('span',{staticClass:\"replace\",on:{\"click\":function($event){$event.stopPropagation();_vm.replace(item.id,item,index)}}},[_vm._v(\"替换\")]),_vm._v(\" \"),_c('span',{staticClass:\"remove\",on:{\"click\":function($event){$event.stopPropagation();_vm.remove(item.id)}}},[_vm._v(\"删除\")])])])]),_vm._v(\" \"),_c('div',{staticClass:\"item-opera\"},[_c('p',{staticClass:\"tip\"},[_vm._v(\"备注：\"+_vm._s(item.remark))]),_vm._v(\" \"),_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.addEquip}},[_vm._v(\"水表录入\")])],1),_vm._v(\" \"),_c('p',{staticStyle:{\"padding-left\":\"15px\"}},[_vm._v(\"当前录入数量：\"+_vm._s(item.list.length))]),_vm._v(\" \"),_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":item.list,\"row-class-name\":function (ref){\n\tvar row = ref.row;\n\n\treturn row.offline&&'offline';\n}},on:{\"selection-change\":_vm.handleSelectionChange}},[_c('el-table-column',{attrs:{\"prop\":\"deviceNumber\",\"label\":\"设备编号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"houseNumber\",\"label\":\"设备位置\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"setupDatetime\",\"label\":\"录入时间\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(water){return [_c('div',{staticStyle:{\"text-align\":\"center\"}},[_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"text\"},on:{\"click\":function($event){_vm.deleteWater(item.list,water.row.deviceNumber,water.row,water)}}},[_vm._v(\"删除\")]),_vm._v(\" \"),_c('span'),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"text\"},on:{\"click\":function($event){_vm.$refs.edition.show(water.row)}}},[_vm._v(\"详情\")])],1)]}}])})],1)],2)})),_vm._v(\" \"),(this.listDate.length==0)?_c('div',{staticClass:\"origintip\"},[_c('i',{staticClass:\"el-icon-warning\"}),_vm._v(\" \"),_c('span',[_vm._v(\"您还未创建虚拟采集器,点击右上角添加创建虚拟采集器\")])]):_vm._e()],1)]),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":\"提示\",\"visible\":_vm.dialogVisible,\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('span',[_vm._v(\"请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除\")]),_vm._v(\" \"),_c('br'),_c('br'),_vm._v(\" \"),_c('div',[_vm._v(\"\\n          虚拟采集器ID：\"+_vm._s(_vm.id)+\"\\n      \")]),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"remarks\"}},[_vm._v(\"\\n          新的设备ID\"),_c('el-input',{attrs:{\"placeholder\":\"请输入ID\"},model:{value:(_vm.trueId),callback:function ($$v) {_vm.trueId=$$v},expression:\"trueId\"}})],1),_vm._v(\" \"),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.confirm(_vm.trueId)}}},[_vm._v(\"确 定\")])],1)]),_vm._v(\" \"),_c('edit',{ref:\"edition\"})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/_vue-loader@13.3.0@vue-loader/lib/template-compiler?{\"id\":\"data-v-4f96abe9\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/_vue-loader@13.3.0@vue-loader/lib/selector.js?type=template&index=0!./src/components/list/invented/invented.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/_extract-text-webpack-plugin@3.0.0@extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-4f96abe9\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":true}!less-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/selector?type=styles&index=0!./invented.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/selector?type=script&index=0!./invented.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-4f96abe9\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/_vue-loader@13.3.0@vue-loader/lib/selector?type=template&index=0!./invented.vue\"\n/* template functional */\n  var __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/list/invented/invented.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}