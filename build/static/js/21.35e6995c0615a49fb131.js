webpackJsonp([21],{"8RAG":function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=n("//Fk"),i=n.n(a),o=n("a5VY"),s=n("zL8q"),r=n("jkKj"),c=n.n(r),l=n("BlC7"),d=(n("IcnI"),{data:function(){return{area:"请选择地区",map:"",tabPosition:"采集器",pointDate:[],equipId:""}},mounted:function(){var t=this;this.equipDate().then(function(){t.creatMap()})},computed:{equipStore:function(){return this.$store.state.qrId}},methods:{areaConfirm:function(t){var e=[];t.map(function(t,n){e.push(t.part)}),this.area=e.join("-");var n=[];t.map(function(t,e){t.id>=0&&n.push(t)});var a=n.length>0&&n[n.length-1].part,i=(1==n.length?10:2==n.length&&12)||3==n.length&&15;this.map.centerAndZoom(String(a),i)},searchOne:function(){var t=this;this.equipId&&(s.Loading.service({fullscreen:!0}),this.$http.get("/weiXin/api/v1/deviceManager/getDeviceByDeviceNum",{deviceNumber:this.equipStore||this.equipId}).then(function(e){e&&e.data.data.length>0&&e.data.data[0].latitude?t.$nextTick(function(){this.map.centerAndZoom(new c.a.Point(e.data.data[0].longitude,e.data.data[0].latitude),18),s.Loading.service({fullscreen:!0}).close()}):(t.$message({type:"info",message:"无为之信息或设备不存在"}),s.Loading.service({fullscreen:!0}).close())}))},slctAddress:function(){this.$refs.slcAdress.show()},handleChange:function(t){console.log(t)},equipDate:function(){var t=this;return new i.a(function(e){s.Loading.service({fullscreen:!0}),t.$http.get("/weiXin/api/v1/deviceManager/getDeviceAndCollector").then(function(n){if(0==n.data.code){var a=[];n.data.data.map(function(t,e){a.push([t.longitude,t.latitude,t])}),t.pointDate=a,e()}else s.Loading.service({fullscreen:!0}).close()}).catch(function(){s.Loading.service({fullscreen:!0}).close()})})},creatMap:function(){var t=this,e=new c.a.Map("allmap"),n=new c.a.Geolocation,a=new c.a.Geocoder;e.enableScrollWheelZoom(),e.enableContinuousZoom(),n.enableSDKLocation(),n.getCurrentPosition(function(n){if(this.getStatus()==BMAP_STATUS_SUCCESS){var i=new c.a.Marker(n.point);e.addOverlay(i),e.panTo(n.point);var o=new c.a.Point(n.point.lng,n.point.lat);e.setCenter(n.point),a.getLocation(o,function(e){e&&(console.log(e),t.area=e.addressComponents.province+"-"+e.addressComponents.city+"-"+e.addressComponents.district)})}else alert("failed"+this.getStatus())});var i={width:200,height:130,title:"信息窗口",enableMessage:!0},o=[],r=new c.a.Icon("http://home.terabits.cn/eq.png",new c.a.Size(35,35));this.pointDate.forEach(function(t){var n=new c.a.Point(t[0],t[1]),a=new c.a.Marker(n,{icon:r,offset:new c.a.Size(0,-10)});e.centerAndZoom(n,15),e.addOverlay(a),o.push(a);var i=1==t[2].deviceType&&"singlemeter?id="+t[2].deviceNumber||2==t[2].deviceType&&"coloterManage?id="+t[2].deviceNumber;a.addEventListener("click",function(e){l('\n\t\t\t\t\t\t<div class="mapInfo">\n\t\t\t\t\t\t\t<p>设备Id: '+t[2].deviceNumber+"<p>\n\t\t\t\t\t\t\t<p>详细位置: "+(t[2].districtDetail||"暂无")+"<p>\n\t\t\t\t\t\t\t<p>设备类型: "+(1==t[2].deviceType?"无线单表":2==t[2].deviceType&&"采集器")+'<p>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<label class="infoDetail">\n\t\t\t\t\t\t\t<a href="\n\t\t\t\t\t\t\t'+(window.location.href.substring(0,window.location.href.lastIndexOf("/")+1)+i)+'">详情</a>\n\t\t\t\t\t\t<label>\n\t\t\t\t\t\t',e)})});var l=function(t,n){var a=n.target,o=new c.a.Point(a.getPosition().lng,a.getPosition().lat),s=new c.a.InfoWindow(t,i);e.openInfoWindow(s,o)};e.addControl(new c.a.NavigationControl),s.Loading.service({fullscreen:!0}).close();new BMapLib.MarkerClusterer(e,{markers:o});this.map=e},mapData:function(){var t=this,e=this,n=[];if(this.pointDate.length>0){this.pointDate.map(function(e){var a=new c.a.Point(e[0],e[1]);t.map.centerAndZoom(a,15);var i=new c.a.Marker(a);n.push(new c.a.Marker(a)),t.map.addOverlay(i)});new BMapLib.MarkerClusterer(this.map,{markers:n});var a=new c.a.Geolocation,i=new c.a.Geocoder;a.enableSDKLocation(),a.getCurrentPosition(function(t){if(this.getStatus()==BMAP_STATUS_SUCCESS){var n=new c.a.Marker(t.point);new c.a.Point(t.point.lng,t.point.lat);e.map.addOverlay(n),e.map.setCenter(t.point),i.getLocation(new c.a.Point(t.point.lng,t.point.lat),function(t){t&&(e.area=t.addressComponents.province+"-"+t.addressComponents.city+"-"+t.addressComponents.district)})}else alert("failed"+e.getStatus())})}else{a=new c.a.Geolocation,i=new c.a.Geocoder;a.enableSDKLocation(),a.getCurrentPosition(function(t){if(this.getStatus()==BMAP_STATUS_SUCCESS){var n=new c.a.Marker(t.point);new c.a.Point(t.point.lng,t.point.lat);this.map.addOverlay(n),this.map.setCenter(t.point),i.getLocation(new c.a.Point(t.point.lng,t.point.lat),function(t){t&&(e.area=t.addressComponents.province+"-"+t.addressComponents.city+"-"+t.addressComponents.district)})}else alert("failed"+this.getStatus())})}}},components:{selectAddress:o.a,QR:l.a},activated:function(){var t=this;this.equipDate().then(function(){t.map&&t.mapData()})}}),p={render:function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"collectorList"}},[n("div",{staticClass:"block2"},[n("span",{staticClass:"seletArea",on:{click:function(e){e.stopPropagation(),t.slctAddress(e)}}},[t._v(t._s(t.area))])]),t._v(" "),n("div",{staticClass:"baidumap",attrs:{id:"allmap"}}),t._v(" "),n("div",{staticClass:"block"},[n("div",{staticClass:"qr"},[n("el-input",{staticClass:"idSearch",attrs:{placeholder:"输入设备编号"},model:{value:t.equipId,callback:function(e){t.equipId=e},expression:"equipId"}}),t._v(" "),n("QR")],1),t._v(" "),n("el-row",[n("el-button",{staticClass:"searchConfirm",attrs:{type:"primary"},on:{click:t.searchOne}},[t._v("查询")])],1)],1),t._v(" "),n("selectAddress",{ref:"slcAdress",on:{areaConfirm:t.areaConfirm}})],1)},staticRenderFns:[]};var u=n("VU/8")(d,p,!1,function(t){n("j4mT")},null,null);e.default=u.exports},j4mT:function(t,e){}});
//# sourceMappingURL=21.35e6995c0615a49fb131.js.map