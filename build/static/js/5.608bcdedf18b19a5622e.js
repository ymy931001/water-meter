webpackJsonp([5,19],{"21vz":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("//Fk"),a=i.n(n),o=i("Dd8w"),s=i.n(o),r=i("mvHQ"),l=i.n(r),c=i("GQaK"),u=i("hhiW"),d=i("qn9g"),f={components:{edit:u.a},props:{},data:function(){return{activeName:"",freshData:!1,marks:"备注",id:"",trueId:"",listDate:[],dialogVisible:!1,tableData:[],multipleSelection:[],inventSCroll:null,data:[{cityId:383,CollectorNum:"19110722",consumerUname:"",deviceNumber:"1509800029",districtDetail:"钱江路-",districtId:3234,districtSite:"",houseNumber:"101",latitude:30.25924446,longitude:120.21937542,provinceId:31,telephone:"",type:3},{cityId:383,CollectorNum:"19110722",consumerUname:"",deviceNumber:"1509800068",districtDetail:"钱江路-",districtId:3234,districtSite:"",houseNumber:"102",latitude:30.25924446,longitude:120.21937542,provinceId:31,telephone:"",type:3}]}},watch:{},computed:{},methods:{handleChange:function(t){this.id=t},handleSelectionChange:function(t){this.multipleSelection=t},addEquip:function(){this.$router.push({path:"/watermeter",query:{inventedID:this.id}})},offlineSetUp:function(){var t=this;this.water.forEach(function(t){t.collectorNum=t.CollectorNum}),this.$confirm("是否导入所有离线设备","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){t.water.length>0?t.$http.post("/weiXin/api/v1/deviceManager/bashGeneralInstall",t.water,{"Content-Type":"application/json;"},!0).then(function(e){e&&(e.data.data?(localStorage.setItem("watermeter",e.data.data),t.$message({type:"error",message:JSON.parse(e.data.data).length+"个设备导入失败"})):t.$message({type:"success",message:"导入成功"}),t.searchData())}):t.$message({type:"error",message:"暂无离线设备"})}).catch(function(){})},deleteWater:function(t,e,i,n){var a=this;this.$confirm("是否删除水表 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){i.offline?(Object(d.c)("watermeter",e),t.splice(n.$index,1),a.$message({type:"success",message:"删除成功!"})):a.$http.get("/weiXin/api/v1/deviceMend/deleteDevice",{deviceNum:e,deviceType:3}).then(function(i){i&&(t.forEach(function(i,n){i.deviceNumber==e&&t.splice(n,1)}),a.$message({type:"success",message:"删除成功!"}))})}).catch(function(){})},replace:function(t,e,i){this.dialogVisible=!0,this.id=t,this.replaceIndex=i},initScroll:function(t,e){var i=this;t?t.refresh():(t=new c.default(e,{click:!0,pullDownRefresh:{threshold:55,txt:"刷新"}})).on("pullingDown",function(){i.searchData().then(function(e){t.refresh(),t.finishPullDown()})})},installWater:function(t,e){var i=this;return this.$http.post("/weiXin/api/v1/deviceManager/bashGeneralInstall",e,{"Content-Type":"application/json;"},!0).then(function(e){if(e){if(e.data.data){var n=JSON.parse(e.data.data);return n.forEach(function(t){t.CollectorNum=i.id}),t=t.concat(n),localStorage.setItem("watermeter",l()(t)),i.water=t,n}return[]}})},setup:function(){var t=this;this.$http.get("/weiXin/api/v1/virtualDevice/replaceVirtualCollectorNum",{deviceNumber:this.trueId,virtualCollectorId:this.id}).then(function(e){0==e.data.code?(t.$message({type:"success",message:"替换成功"}),t.listDate.splice(t.replaceIndex,1),t.dialogVisible=!1):(t.dialogVisible=!1,t.$message({type:"error",message:e.data.message}))}).catch(function(e){t.dialogVisible=!1})},confirm:function(t){var e=this;if(this.water.length>0){var i=JSON.parse(l()(this.water)),n=[];i=i.filter(function(t){return t.CollectorNum!=e.id||(n.push(s()({},t,{collectorNum:e.trueId,type:3,time:(new Date).getTime()})),!1)}),n.length>0&&this.installWater(i,n).then(function(t){0==t.length?(e.setup(),localStorage.setItem("watermeter",l()(i))):(e.searchData(),e.$message({type:"error",message:"部分水表安装失败"}),e.dialogVisible=!1)})}else this.setup()},remove:function(t){var e=this;this.$confirm("是否删除虚拟机？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(function(){e.$http.get("/weiXin/api/v1/virtualDevice/deleteVirtualCollectorNum",{virtualCollectorId:t}).then(function(i){0==i.data.code?e.listDate.forEach(function(i,n){i.id==t&&e.listDate.splice(n,1)}):24==i.data.code?e.$message({type:"error",message:"该设备下仍挂接水表不能删除,请点击替换设备"}):e.$message({type:"error",message:"删除失败"})})}).catch(function(t){})},creatVirtual:function(){var t=this;this.$prompt("请输入备注信息","添加采集器",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){if(null==t)return!1},inputErrorMessage:"请输入备注"}).then(function(e){var i=e.value;t.$http.get("/weiXin/api/v1/virtualDevice/getVirtualCollectorNum",{remark:i}).then(function(e){0==e.data.code?t.listDate.push({id:e.data.data,remark:i,list:[],ind:Math.random(10)}):t.$message({type:"info",message:"添加失败"})})}).catch(function(){})},searchData:function(){var t=this;return this.water=localStorage.getItem("watermeter")?JSON.parse(localStorage.getItem("watermeter")):[],new a.a(function(e){t.freshData=!0,t.$http.get("/weiXin/api/v1/virtualDevice/getAllVirtualCollectorNum",{pageNum:1,pageSize:200}).then(function(i){t.freshData=!1;var n=i.data.data.map(function(e,i){var n=e.list;return t.water&&t.water.forEach(function(t){t.CollectorNum==e.id&&(t.offline=!0,n.push(t))}),{id:e.id,remark:e.remark,list:n,ind:i}});t.listDate=n,e()})})}},created:function(){this.searchData()},mounted:function(){var t=this;this.$nextTick(function(){t.initScroll(t.inventScroll,t.$refs.inventWrapper)})}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"invented"}},[i("div",{staticClass:"opera"},[i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.offlineSetUp}},[t._v("离线录入")]),t._v(" "),i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.creatVirtual}},[t._v("添加采集器")])],1),t._v(" "),i("div",{ref:"inventWrapper",staticClass:"cloWra"},[i("div",[i("el-collapse",{directives:[{name:"loading",rawName:"v-loading",value:t.freshData,expression:"freshData"}],staticClass:"elist",attrs:{accordion:""},on:{change:t.handleChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.listDate,function(e,n){return i("el-collapse-item",{key:e.ind,attrs:{name:e.id}},[i("template",{attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"invtitle"},[i("p",[t._v("编号："+t._s(e.id))]),t._v(" "),i("div",[i("span",{staticClass:"replace",on:{click:function(i){i.stopPropagation(),t.replace(e.id,e,n)}}},[t._v("替换")]),t._v(" "),i("span",{staticClass:"remove",on:{click:function(i){i.stopPropagation(),t.remove(e.id)}}},[t._v("删除")])])])]),t._v(" "),i("div",{staticClass:"item-opera"},[i("p",{staticClass:"tip"},[t._v("备注："+t._s(e.remark))]),t._v(" "),i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.addEquip}},[t._v("水表录入")])],1),t._v(" "),i("p",{staticStyle:{"padding-left":"15px"}},[t._v("当前录入数量："+t._s(e.list.length))]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,"row-class-name":function(t){return t.row.offline&&"offline"}},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{prop:"deviceNumber",label:"设备编号"}}),t._v(" "),i("el-table-column",{attrs:{prop:"houseNumber",label:"设备位置"}}),t._v(" "),i("el-table-column",{attrs:{prop:"setupDatetime",label:"录入时间"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(n){return[i("div",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.deleteWater(e.list,n.row.deviceNumber,n.row,n)}}},[t._v("删除")]),t._v(" "),i("span"),t._v(" "),i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.$refs.edition.show(n.row)}}},[t._v("详情")])],1)]}}])})],1)],2)})),t._v(" "),0==this.listDate.length?i("div",{staticClass:"origintip"},[i("i",{staticClass:"el-icon-warning"}),t._v(" "),i("span",[t._v("您还未创建虚拟采集器,点击右上角添加创建虚拟采集器")])]):t._e()],1)]),t._v(" "),i("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("span",[t._v("请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除")]),t._v(" "),i("br"),i("br"),t._v(" "),i("div",[t._v("\n          虚拟采集器ID："+t._s(t.id)+"\n      ")]),t._v(" "),i("div",{attrs:{id:"remarks"}},[t._v("\n          新的设备ID"),i("el-input",{attrs:{placeholder:"请输入ID"},model:{value:t.trueId,callback:function(e){t.trueId=e},expression:"trueId"}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.confirm(t.trueId)}}},[t._v("确 定")])],1)]),t._v(" "),i("edit",{ref:"edition"})],1)},staticRenderFns:[]};var h=i("VU/8")(f,p,!1,function(t){i("swjw")},null,null);e.default=h.exports},GPSQ:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i("Dd8w"),a=i.n(n),o=i("//Fk"),s=i.n(o),r=i("Gu7T"),l=i.n(r),c=i("BO1k"),u=i.n(c),d=i("21vz"),f=i("BlC7"),p=(i("IcnI"),i("bQhI")),h=i("GQaK"),v=i("hhiW"),m={components:{invented:d.default,QR:f.a,more:p.a,edit:v.a},props:{},data:function(){return{isDown:!1,pageNum:null,checkList:[],collectoWrapper:null,SelectionArray:[],pollingTabs:"first",watermeterdeviceNum:"",oneData:"",tableData:[],offLineSum:0,onLineSum:0}},filters:{filtTableData:function(t,e){if(1==e.length){var i=[],n=!0,a=!1,o=void 0;try{for(var s,r=u()(t);!(n=(s=r.next()).done);n=!0){var l=s.value;l.onlineStatus==e[0]&&i.push(l)}}catch(t){a=!0,o=t}finally{try{!n&&r.return&&r.return()}finally{if(a)throw o}}return i}return t}},computed:{qrId:function(){return this.$store.state.qrId}},watch:{qrId:function(t){this.oneData=t}},methods:{hideMenu:function(){this.$refs.waterMenu.classList.toggle("isShow")},waterRowClassName:function(t){return"在线"==t.onlineStatus?"onlineSingle":"离线"==t.onlineStatus?"offlineSingle":void 0},initScroll:function(t,e){var i=this;t?t.refresh():((t=new h.default(e,{scrollX:!0,click:!0,directionLockThreshold:5,pullDownRefresh:{threshold:55,txt:"刷新"}})).on("scroll",function(t){i.isDown?i.isDown?i.$refs.freshing.style.transform="translate(0,20px)":i.isUp:i.$refs.isDown.style.transform="translate(0,"+(t.y-40)+"px)"}),t.on("pullingDown",function(){console.log(t),i.isDown=!0,i.getListDataFromNet(i.pageNum,function(e){var n;i.tableData=[],(n=i.tableData).push.apply(n,l()(e)),i.isDown=!1,t.refresh(),t.finishPullDown(),e.length})}))},getListDataFromNet:function(t,e){var i=this;setTimeout(function(){i.oneData?i.searchData(t,i.oneData).then(function(t){e(t)}):i.searchData(t).then(function(t){e(t)})},1e3)},checkOnline:function(t){return t==this.checkList[0]||(this.checkList.length>1||0==this.checkList.length||void 0)},testStyle:function(t){return"离线"==t.row.onlineStatus?"warning-row":"在线"==t.row.onlineStatus?"success-row":void 0},collectorSelectionChange:function(t){this.SelectionArray=t},collectClick:function(t,e,i){this.batchProcessing||(console.log(t),this.$router.push({path:"/watermeterDetail",query:{deviceNum:t.id,pid:t.provinceId,cid:t.cityId,did:t.districtId}}))},reText:function(t){var e=this;this.$confirm("是否进行轮询测试","提示",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(i,n,a){"confirm"===i?(n.confirmButtonLoading=!0,n.confirmButtonText="执行中...",setTimeout(function(){e.$http.get("/weiXin/api/v1/deviceManager/pollingTest",{deviceNum:t}).then(function(t){n.confirmButtonLoading=!1,t?a():n.confirmButtonText="确定"})},2e3)):a()}}).then(function(i){e.$http.get("/weiXin/api/v1/deviceManager/queryAll",{deviceNum:t}).then(function(t){t&&e.$message({type:"success",message:"测试已提交"})})}).catch(function(t){})},upload:function(t){var e=this;this.$confirm("是否上报轮询测试数据","提示",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(i,n,a){"confirm"===i?(n.confirmButtonLoading=!0,n.confirmButtonText="执行中...",setTimeout(function(){e.$http.get("/weiXin/api/v1/deviceManager/queryAll",{deviceNum:t}).then(function(t){t?(a(),n.confirmButtonLoading=!1,n.confirmButtonText="确定",e.$message({type:"success",message:"数据已上报"})):(a(),n.confirmButtonLoading=!1,n.confirmButtonText="确定")})},2e3)):a()}}).then(function(t){}).catch(function(t){})},remove:function(t,e,i){var n=this;this.$confirm("是否移除该采集器","提示",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(a,o,s){"confirm"===a?n.$http.get("/weiXin/api/v1/deviceMend/deleteDevice",{deviceNum:t,deviceType:2}).then(function(t){t&&(i.splice(e,1),s())}):s()}})},searchData:function(t,e){var i=this;return new s.a(function(n){i.$http.post("/weiXin/api/v1/deviceManager/getListDeviceBySearch",{collectorSearchField:i.deviceNum,pageNum:t,pageSize:null,searchField:e,type:2},{"Content-Type":"application/json;"},!0).then(function(t){if(t){i.onLineSum=t.data.data.onLineSum,i.offLineSum=t.data.data.offLineSum;var e=t.data.data.list.map(function(t){return a()({},t,{id:t.deviceNumber,waterNum:t.generalQuantitySum,test:(0==t.pollingTest?"未测试":1==t.pollingTest&&"已测试")||2==t.pollingTest&&"离线"||3==t.pollingTest&&"测试中",onlineStatus:1==t.onlineStatus?"在线":"离线",completeDistrict:t.completeDistrict,houseNumber:t.houseNumber,districtSite:t.districtSite,deviceType:2,signalIntensity:t.signalIntensity,baseStation:t.baseStation})});e.sort(function(t,e){return t.id-e.id}),n(e)}}).catch(function(t){})})},searchoneData:function(){var t=this;this.oneData&&this.searchData(this.pageNum,this.oneData).then(function(e){t.tableData=[].concat(l()(e)),t.$nextTick(function(){t.initScroll(t.collectoWrapper,t.$refs.collectorScroll)})})},watermeterSwitch:function(t,e,i){console.log(i),this.watermeterdeviceNum=e,this.meterSwitch=!0,this.radioSwitch=i}},created:function(){},mounted:function(){var t=this;this.$route.query.id?(this.oneData=this.$route.query.id,this.searchoneData()):this.searchData(this.pageNum).then(function(e){var i;(i=t.tableData).push.apply(i,l()(e)),t.$nextTick(function(){t.initScroll(t.collectoWrapper,t.$refs.collectorScroll)})})}},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"coloterManage"}},[i("header",[i("el-row",{staticClass:"header-title",attrs:{type:"flex",justify:"space-between"}},[i("el-col",{attrs:{span:4}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-arrow-left"},on:{click:function(e){t.$router.push("./nav")}}},[t._v("返回")])],1),t._v(" "),i("el-col",{attrs:{span:6}},[i("span",[t._v(t._s(this.title))])]),t._v(" "),i("el-col",{staticClass:"addColltector",attrs:{span:4}},[i("more",{ref:"moreOperation"},[i("ul",{attrs:{slot:"list"},slot:"list"},[i("li",{on:{click:function(e){t.$router.push({path:"/collector",query:{type:2}})}}},[t._v("添加采集器")]),t._v(" "),i("li",{on:{click:t.hideMenu}},[t._v("菜单栏")])])])],1)],1),t._v(" "),i("div",{ref:"waterMenu",staticClass:"water-menu"},[i("div",{staticClass:"qrSearch"},[i("el-input",{staticClass:"idSearch",attrs:{placeholder:"编号/小区/门牌号"},model:{value:t.oneData,callback:function(e){t.oneData=e},expression:"oneData"}}),t._v(" "),i("QR")],1),t._v(" "),i("el-row",{staticClass:"head-check"},[i("el-col",{attrs:{span:18}},[i("el-checkbox-group",{model:{value:t.checkList,callback:function(e){t.checkList=e},expression:"checkList"}},[i("el-checkbox",{attrs:{label:"在线"}},[t._v("在线："+t._s(t.onLineSum))]),t._v(" "),i("el-checkbox",{attrs:{label:"离线"}},[t._v("离线："+t._s(t.offLineSum))])],1)],1),t._v(" "),i("el-col",{attrs:{span:6}},[i("el-button",{staticClass:"searchConfirm",attrs:{type:"text"},on:{click:t.searchoneData}},[t._v("查询")])],1)],1)],1)],1),t._v(" "),i("div",{staticClass:"block "},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isDown,expression:"!isDown"}],ref:"isDown",staticClass:"isDown"},[t._v("刷新数据")]),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:t.isDown,expression:"isDown"}],ref:"freshing"},[i("i",{staticClass:"el-icon-loading"}),t._v("刷新中")]),t._v(" "),i("div",{ref:"collectorScroll",staticClass:"Wrapper"},[i("div",{ref:"wrapperContent"},[i("el-table",{ref:"multipleTable",staticClass:"searchResult",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",data:t._f("filtTableData")(t.tableData,t.checkList)},on:{"selection-change":t.collectorSelectionChange}},[i("el-table-column",{attrs:{label:t._f("filtTableData")(t.tableData,t.checkList).length.toString(),width:"40"},scopedSlots:t._u([{key:"default",fn:function(e){var i=e.$index;return[t._v("\n                           "+t._s(i+1)+" \n                    ")]}}])}),t._v(" "),i("el-table-column",{attrs:{prop:"id",label:"采集器编号"}}),t._v(" "),i("el-table-column",{attrs:{prop:"districtDetail",label:"详细地址"}}),t._v(" "),i("el-table-column",{attrs:{prop:"districtSite",label:"小区"}}),t._v(" "),i("el-table-column",{attrs:{prop:"houseNumber",label:"具体位置"}}),t._v(" "),i("el-table-column",{attrs:{label:"水表数量"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(n.waterNum)+"\n\t\t\t\t\t\t\t\t"),i("span",{staticClass:"waterDetail",on:{click:function(e){e.stopPropagation(),t.collectClick(n)}}},[t._v("详情")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"轮询测试"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[t._v("\n\t\t\t\t\t\t\t\t"+t._s(n.test)+"\n\t\t\t\t\t\t\t\t"),i("span",{staticClass:"waterDetail",on:{click:function(e){e.stopPropagation(),t.reText(n.id)}}},[t._v("测试")])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"在线情况"},scopedSlots:t._u([{key:"default",fn:function(e){var n=e.row;return[i("div",{class:t.waterRowClassName(n)},[t._v("\n\t\t\t\t\t\t\t\t"+t._s(n.onlineStatus)+"\n\t\t\t\t\t\t\t\t"),i("span",{staticClass:"waterDetail",on:{click:function(e){e.stopPropagation(),t.$router.push({path:"/offlineRecord",query:{deviceId:n.id}})}}},[t._v("离线记录")])])]}}])}),t._v(" "),i("el-table-column",{attrs:{label:"操作",width:"250px"},scopedSlots:t._u([{key:"default",fn:function(e){return["已测试"==e.row.test?i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){i.stopPropagation(),t.upload(e.row.id)}}},[t._v("上报数据")]):t._e(),t._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){i.stopPropagation(),t.remove(e.row.id,e.$index,t.tableData)}}},[t._v("移除")]),t._v(" "),i("el-button",{attrs:{type:"text",size:"small"},on:{click:function(i){i.stopPropagation(),t.$refs.edition.show(e.row)}}},[t._v("详细数据")])]}}])})],1)],1)])]),t._v(" "),i("edit",{ref:"edition"})],1)},staticRenderFns:[]};var w=i("VU/8")(m,g,!1,function(t){i("cF/T")},null,null);e.default=w.exports},"cF/T":function(t,e){},swjw:function(t,e){}});
//# sourceMappingURL=5.608bcdedf18b19a5622e.js.map