webpackJsonp([14],{iVqr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("rVsN"),a=n.n(i),o=(n("t+b9"),n("YUvS")),l=n("BlC7"),s=(n("7Adc"),n("IcnI"),{components:{QR:l.a},props:{},data:function(){return{collectorScroll:null,singleScroll:null,equipId:this.$store.state.qrId,activeName:"2",onfix:!1,collectorData:[],singleData:[],oneDate:[],tabObj:1,dialogVisible:!1,loading:!1,netloading:!1,filters:[{text:"通过",value:"通过"},{text:"未通过",value:"未通过"},{text:"未测试",value:"未测试"}],filters2:[{text:"通过",value:"通过"},{text:"未通过",value:"未通过"},{text:"未测试",value:"未测试"}],loadingClo:!1,colloectrPage:1,singlemeterPage:1}},computed:{qrId:function(){return this.$store.state.qrId}},watch:{qrId:function(e){this.equipId=e}},methods:{equipTabel:function(e){var t=e.row;e.rowIndex;if("通过"!==t.result)return"warning-row"},filterType:function(e,t,n){return t.result===e},filterType2:function(e,t,n){return t.result===e},initScroll:function(e,t){var n=this;e?e.refresh():((e=new o.default(t,{scrollX:!1,eventPassthrough:"horizontal",pullUpLoad:{threshold:-50},pullDownRefresh:{threshold:-50}})).on("pullingUp",function(){2==n.activeName?(n.colloectrPage++,n.searchDate(n.activeName,n.colloectrPage).then(function(){e.finishPullUp(),e.refresh()})):1==n.activeName&&(n.singlemeterPage++,n.searchDate(n.activeName,n.singlemeterPage).then(function(){e.finishPullUp(),e.refresh()}))}),e.on("pullingDown",function(){2==n.activeName?(n.colloectrPage=1,n.collectorData=[],n.searchDate(n.activeName,1).then(function(){e.finishPullDown(),e.refresh()})):1==n.activeName&&(n.singleData=[],n.singlemeterPage=1,n.searchDate(n.activeName,1).then(function(){e.finishPullDown(),e.refresh()}))}))},searchEquipByid:function(){var e=this;this.equipId&&(this.dialogVisible=!0,this.loading=!0,this.$http.get("/weiXin/api/v1/deviceManager/getDeviceByDeviceNum",{deviceNumber:this.equipId}).then(function(t){var n=t.data.data[0],i=[];i.push({props:"设备类别",num:(1==n.deviceType?"无线单表":2==n.deviceType&&"采集器")||3==n.deviceType&&"水表"},{props:"设备ID",num:n.deviceNumber},{props:"设备地址",num:n.completeDistrict},{props:"测试结果",num:(0==n.networkingTest?"未测试":1==n.networkingTest&&"通过")||2==n.networkingTest&&"未通过"}),e.oneDate=i,e.loading=!1}).catch(function(t){e.loading=!1}))},handleClick:function(e,t){this.tabObj="采集器"==e._props.label?1:"无线单表"==e._props.label&&2},onlineTest:function(e){var t=this;this.$confirm("是否进行联网测试","提示",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(n,i,a){"confirm"===n?(i.confirmButtonLoading=!0,i.confirmButtonText="执行中...",t.$http.post("/weiXin/api/v1/deviceManager/networkingTest",{deviceNums:[e],deviceType:t.activeName},{"Content-Type":"application/json; charset=UTF-8"},!0).then(function(n){n&&0==n.data.code?(i.confirmButtonLoading=!1,i.confirmButtonText="确定",a(),t.$message({type:"success",message:e+n.data.message})):(i.confirmButtonLoading=!1,i.confirmButtonText="确定")})):a()}}).then(function(e){}).catch(function(e){})},pollingTest:function(e){var t=this;this.$confirm("是否进行轮询测试","提示",{confirmButtonText:"确定",cancelButtonText:"取消",beforeClose:function(n,i,a){"confirm"===n?(i.confirmButtonLoading=!0,i.confirmButtonText="执行中...",t.$http.get("/weiXin/api/v1/deviceManager/pollingTest",{deviceNum:e}).then(function(e){e&&0==e.data.code?(i.confirmButtonLoading=!1,i.confirmButtonText="确定",t.$message({type:"success",message:"已提交测试请求"}),a()):(i.confirmButtonLoading=!1,i.confirmButtonText="确定")})):a()}}).then(function(e){}).catch(function(e){})},onlineTestResult:function(e){this.$router.push({path:"/testonlineResult",query:{testId:e}})},searchDate:function(e,t){var n=this;return new a.a(function(i){n.loadingClo=!0,n.$http.post("/weiXin/api/v1/deviceManager/getListDeviceBySearch",{type:e,pageSize:10,pageNum:t},{"Content-Type":"application/json;charset=UTF-8"},!0).then(function(t){if(n.loadingClo=!1,t&&t.data.data.list.length>0){var a=t.data.data.list.map(function(e,t){return{id:e.deviceNumber,address:e.completeDistrict,result:(0==e.networkingTest?"未测试":1==e.networkingTest&&"通过")||2==e.networkingTest&&"未通过"||3==e.networkingTest&&"测试中"}});2==e?n.collectorData=n.collectorData.concat(a):1==e&&(n.singleData=n.singleData.concat(a)),i()}}).catch(function(e){n.loadingClo=!1})})},confirm:function(){var e=this;console.log(this.oneDate),this.netloading=!0,this.$http.post("/weiXin/api/v1/deviceManager/networkingTest",{deviceNums:[this.oneDate[1].num],deviceType:"采集器"==this.oneDate[0].num?2:"无线单表"==this.oneDate[0].num&&1},{"Content-Type":"application/json; charset=UTF-8"},!0).then(function(t){t?(e.netloading=!1,e.$message({type:"success",message:e.oneDate[1].num+"联网测试已下发"})):e.netloading=!1})}},created:function(){},mounted:function(){var e=this;this.searchDate(2,1).then(function(){return e.searchDate(1,1)}).then(function(){return e.loadingClo=!1}),this.$nextTick(function(){e.initScroll(e.collectorScroll,e.$refs.collectorWrapper),e.initScroll(e.singleScroll,e.$refs.singleWrapper)})},destroyed:function(){window.removeEventListener("scroll",this.handleScroll)}}),r={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"textonline"}},[n("div",{staticClass:"block"},[n("div",{staticClass:"qr"},[n("el-input",{staticClass:"idSearch",attrs:{placeholder:"输入或扫描设备编号",clearable:""},model:{value:e.equipId,callback:function(t){e.equipId=t},expression:"equipId"}}),e._v(" "),n("QR")],1),e._v(" "),n("el-row",[n("el-button",{staticClass:"searchConfirm",attrs:{type:"primary"},on:{click:e.searchEquipByid}},[e._v("查询")])],1),e._v(" "),n("el-tabs",{class:{onfix:e.onfix},on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[n("el-tab-pane",{attrs:{label:"采集器",name:"2"}},[n("div",{ref:"collectorWrapper",staticClass:"cloWra"},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loadingClo,expression:"loadingClo"}],staticClass:"searchResult",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",stripe:"","header-row-class-name":"equipHead","row-class-name":e.equipTabel,data:e.collectorData}},[n("el-table-column",{attrs:{fixed:"",prop:"id",label:"设备编号",width:"120"}}),e._v(" "),n("el-table-column",{attrs:{filters:e.filters,"filter-method":e.filterType,prop:"result",label:"测试结果"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){n.stopPropagation(),e.onlineTest(t.row.id)}}},[e._v("联网测试")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){n.stopPropagation(),e.pollingTest(t.row.id)}}},[e._v("轮询测试")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){n.stopPropagation(),e.onlineTestResult(t.row.id)}}},[e._v("联网测试结果")])]}}])})],1)],1)]),e._v(" "),n("el-tab-pane",{attrs:{label:"无线单表",name:"1"}},[n("div",{ref:"singleWrapper",staticClass:"cloWra"},[n("el-table",{staticClass:"searchResult",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",stripe:"","header-row-class-name":"equipHead","row-class-name":e.equipTabel,data:e.singleData}},[n("el-table-column",{attrs:{fixed:"",prop:"id",label:"设备编号",width:"120"}}),e._v(" "),n("el-table-column",{attrs:{filters:e.filters2,"filter-method":e.filterType2,prop:"result",label:"测试结果"}}),e._v(" "),n("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){n.stopPropagation(),e.onlineTest(t.row.id)}}},[e._v("联网测试")]),e._v(" "),n("el-button",{attrs:{type:"text",size:"small"},on:{click:function(n){n.stopPropagation(),e.onlineTestResult(t.row.id)}}},[e._v("联网测试结果")])]}}])})],1)],1)])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"30%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("div",{attrs:{id:"parameterDetail"}},[n("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"searchResult",staticStyle:{width:"100%"},attrs:{size:"mini",border:"",stripe:"","header-row-class-name":"equipHead","row-class-name":"equipTabel",data:e.oneDate}},[n("el-table-column",{attrs:{prop:"props",label:"参数",width:"100"}}),e._v(" "),n("el-table-column",{attrs:{prop:"num",label:"数值"}})],1)],1),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e.netloading?n("i",{staticClass:"el-icon-loading"}):e._e(),e._v(" 重新测试")])],1)])],1)},staticRenderFns:[]};var c=n("46Yf")(s,r,!1,function(e){n("y7vw")},null,null);t.default=c.exports},y7vw:function(e,t){}});
//# sourceMappingURL=14.12347d44d47671025187.js.map