webpackJsonp([13],{MSMW:function(t,e,r){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=r("Dd8w"),i=r.n(o),n=r("a5VY"),s=r("BlC7"),a=(r("IcnI"),r("qn9g")),m={mounted:function(){var t=this;null!=this.$route.query.inventedID&&(this.form.pid=this.$route.query.inventedID),null!=this.$route.query.collectorID&&(this.form.pid=this.$route.query.collectorID),this.getmaparea();var e=function(t,e,r){t.addEventListener?t.addEventListener(e,r,!1):t.attachEvent?t.attachEvent("on"+e,r):t["on"+e]=r};e(window,"online",function(){t.isOffline=!1}),e(window,"offline",function(){t.isOffline=!0})},watch:{qrId:function(t,e){this.form.id=t}},data:function(){var t=this;return{isOffline:!1,options:[],form:{pid:"",id:"",village:"",address:"",name:"",number:"",area:"请选择地区",provinceId:"",cityId:"",istrictId:"",doornumber:"",lat:null,lng:null},rules:{pid:[{required:!0,message:"请输入所属采集器编号",trigger:"blur"}],id:[{required:!0,message:"请输入水表编号",trigger:"change"},{validator:function(e,r,o){r&&(8!=r.charAt(4)&&"D"!=r.charAt(4)&&o(new Error("第5位必须为数字8或者字母D")),r.length<10&&o(new Error("请输入10位有效数字")),r.length>10?t.form.id=r.substring(0,10):o())}}],village:[{required:!0,message:"请输入小区",trigger:"change"}],address:[{required:!0,message:"请填写详细地址",trigger:"change"}],doornumber:[{required:!0,message:"请填写门牌号",trigger:"change"}]}}},methods:{showMore:function(){this.$refs.watermeterMore.classList.toggle("ishow")},getVillage:function(){var t=this;this.$http.get("/weiXin/api/v1/common/getAreaByPid",{id:this.form.istrictId}).then(function(e){e&&(t.options=e.data.data.map(function(t){return{value:t.district,label:t.district}}))})},querySearch:function(t,e){var r=this.options;e(t?r.filter(this.createFilter(t)):r)},createFilter:function(t){return function(e){return 0===e.value.toLowerCase().indexOf(t.toLowerCase())}},getmaparea:function(){var t=this,e=new BMap.Geolocation,r=new BMap.Geocoder;e.enableSDKLocation(),e.getCurrentPosition(function(e){if(this.getStatus()==BMAP_STATUS_SUCCESS){new BMap.Marker(e.point),new BMap.Point(e.point.lng,e.point.lat);t.form.lat=e.point.lat,t.form.lng=e.point.lng,r.getLocation(new BMap.Point(e.point.lng,e.point.lat),function(e){e&&(console.log(e),t.area=e.addressComponents.province+"-"+e.addressComponents.city+"-"+e.addressComponents.district,t.$http.get("/weiXin/api/v1/common/getIdsByDistrict",{province:e.addressComponents.province,city:e.addressComponents.city.substring(0,e.addressComponents.city.length-1),district:e.addressComponents.district.substring(0,e.addressComponents.district.length-1)}).then(function(e){0==e.data.code?(t.form.provinceId=e.data.data[0].id,t.form.cityId=e.data.data[1].id,t.form.istrictId=e.data.data[2].id,t.getVillage()):(t.form.area="请选择地区",t.$message({type:"error",message:"定位失败,请手动选择省市区地址"}))}),t.form.area=e.addressComponents.province+"-"+e.addressComponents.city+"-"+e.addressComponents.district,t.form.address=e.addressComponents.street+"-"+e.addressComponents.streetNumber)})}else alert("failed"+this.getStatus())})},areaConfirm:function(t){var e=this,r=t.map(function(t,e){return t.part});this.$nextTick(function(){e.form.area=r.join("-")});t.map(function(t,e){if(t.id>0)return t});this.form.provinceId=t[0]&&t[0].id,this.form.cityId=t[1]&&t[1].id,this.form.istrictId=t[2]&&t[2].id,this.getVillage()},slctAddress:function(){this.$refs.slcAdress.show()},onSubmit:function(t){var e=this,r={type:3,deviceNumber:this.form.id,houseNumber:this.form.doornumber,longitude:this.form.lng,districtSite:this.form.village,districtDetail:this.form.address,latitude:this.form.lat,provinceId:this.form.provinceId,cityId:this.form.cityId,districtId:this.form.istrictId,consumerUname:this.form.name,telephone:this.form.number,CollectorNum:this.form.pid},o=this;this.$refs[t].validate(function(t){if(!t)return!1;e.$confirm("是否进行安装？","提示",{confirmButtonText:"安装",cancelButtonText:"取消",type:"warning",center:!0,closeOnClickModal:!0,beforeClose:function(t,n,s){"confirm"===t?o.isOffline?(Object(a.b)("watermeter",r),s()):(n.confirmButtonLoading=!0,n.confirmButtonText="执行中...",e.$http.post("/weiXin/api/v1/deviceManager/generalInstall",i()({},r)).then(function(t){t?setTimeout(function(){n.confirmButtonLoading=!1,n.confirmButtonText="安装",s(),e.$message({type:"success",message:e.form.id+"安装成功"})},300):setTimeout(function(){n.confirmButtonLoading=!1,n.confirmButtonText="安装",e.$message({type:"error",message:t.data.message})},300)}).catch(function(t){"timeout"==t&&(Object(a.b)("watermeter",r),n.confirmButtonLoading=!1,n.confirmButtonText="安装",s())})):(s(),n.confirmButtonLoading=!1,n.confirmButtonText="安装")}}).then(function(){e.form.id=e.form.id.substring(0,6),e.form.doornumber=e.form.doornumber.substring(0,e.form.doornumber.length-2)}).catch(function(t){e.$message({type:"confirm"==t?"success":"error",message:"confirm"==t?"提交成功":"提交失败"})})})}},computed:{qrId:function(){return this.$store.state.qrId}},components:{selectAddress:n.a,QR:s.a},activated:function(){this.form.id&&this.form.id>6&&this.$store.commit("changeId",this.form.id.substring(0,6)),this.form.doornumber&&this.form.doornumber.length>2&&(this.form.doornumber=this.form.doornumber.substring(0,this.form.doornumber.length-2))}},d={render:function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"watermeter"}},[r("el-form",{ref:"form",staticClass:"textform",attrs:{model:t.form,"label-width":"95px",rules:t.rules}},[r("el-form-item",{attrs:{label:"门牌号",prop:"doornumber"}},[r("el-input",{attrs:{placeholder:"1-101",clearable:""},model:{value:t.form.doornumber,callback:function(e){t.$set(t.form,"doornumber",e)},expression:"form.doornumber"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"设备编号",prop:"id"}},[r("el-input",{model:{value:t.form.id,callback:function(e){t.$set(t.form,"id",e)},expression:"form.id"}}),t._v(" "),r("QR")],1),t._v(" "),r("el-form-item",{attrs:{label:"所属采集器",prop:"pid"}},[r("el-input",{attrs:{value:t.form.pid}})],1),t._v(" "),r("el-form-item",{attrs:{label:"安装位置"}},[r("span",{staticClass:"seletArea",on:{click:function(e){e.stopPropagation(),t.slctAddress(e)}}},[t._v(t._s(t.form.area))])]),t._v(" "),r("el-form-item",[r("el-button",{attrs:{type:"primary"},on:{click:function(e){t.onSubmit("form")}}},[t._v("提交")])],1),t._v(" "),r("el-button",{staticClass:"showMore",attrs:{type:"text"},on:{click:t.showMore}},[t._v("更多信息"),r("i",{staticClass:"el-icon-arrow-right"})]),t._v(" "),r("div",{ref:"watermeterMore",staticClass:"watermeterMore"},[r("el-form-item",{attrs:{label:"用户姓名",prop:"name"}},[r("el-input",{model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1),t._v(" "),r("el-form-item",{attrs:{label:"联系电话",prop:"number"}},[r("el-input",{model:{value:t.form.number,callback:function(e){t.$set(t.form,"number",e)},expression:"form.number"}})],1)],1)],1),t._v(" "),r("selectAddress",{ref:"slcAdress",on:{areaConfirm:t.areaConfirm}})],1)},staticRenderFns:[]};var c=r("VU/8")(m,d,!1,function(t){r("YDZw")},"data-v-6d49d1d2",null);e.default=c.exports},YDZw:function(t,e){}});
//# sourceMappingURL=13.16c37c8289eff308dd6a.js.map