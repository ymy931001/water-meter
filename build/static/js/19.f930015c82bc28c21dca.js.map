{"version":3,"sources":["webpack:///src/components/list/invented/invented.vue","webpack:///./src/components/list/invented/invented.vue?f4b6","webpack:///./src/components/list/invented/invented.vue"],"names":["invented","edit","cityId","CollectorNum","consumerUname","deviceNumber","districtDetail","districtId","districtSite","houseNumber","latitude","longitude","provinceId","telephone","type","val","id","_this","this","then","res","water","data","$message","message","JSON","parse","length","searchData","catch","_this2","eid","index","_this3","refresh","_","finishPullDown","errorList","waterOrign","_this5","err","_this6","push","extends_default","trueId","getTime","result","meters","setup","_this7","action","_this8","_ref","value","_this9","list","remark","ind","resolve","_this10","inventWrapper","invented_invented","render","_vm","_h","$createElement","_c","_self","attrs","staticClass","size","on","click","offlineSetUp","_v","creatVirtual","ref","directives","name","rawName","expression","accordion","change","handleChange","model","callback","$$v","activeName","_l","item","key","slot","_s","$event","stopPropagation","replace","remove","addEquip","staticStyle","padding-left","width","row-class-name","row","offline","selection-change","handleSelectionChange","prop","label","scopedSlots","_u","fn","text-align","deleteWater","$refs","edition","show","listDate","_e","title","visible","dialogVisible","update:visible","placeholder","confirm","staticRenderFns","Component","__webpack_require__","normalizeComponent","ssrContext","__webpack_exports__"],"mappings":"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","file":"static/js/19.f930015c82bc28c21dca.js","sourcesContent":["<template>\n  <div id=\"invented\">\n    <div class=\"opera\">\n        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"offlineSetUp\">离线录入</el-button>\n        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"creatVirtual\" >添加采集器</el-button>\n    </div>\n    <div class=\"cloWra\" ref=\"inventWrapper\">\n        <div>\n            <el-collapse  accordion class=\"elist\" v-loading=\"freshData\" v-model=\"activeName\" @change=\"handleChange\">\n                <el-collapse-item  :name=\"item.id\" v-for=\"(item,index) in listDate\" :key=\"item.ind\" >\n                    <template slot=\"title\">\n                            <div class=\"invtitle\">\n                                <p>编号：{{item.id}}</p>\n                                <div>\n                                    <span class=\"replace\" @click.stop=\"replace(item.id,item,index)\">替换</span> \n                                    <span class=\"remove\"  @click.stop=\"remove(item.id)\" >删除</span>\n                                </div> \n                            </div>\n                    </template>\n                    \n                    <div class=\"item-opera\">\n                        <p class=\"tip\">备注：{{item.remark}}</p>\n                        \n                        <el-button size=\"mini\" type=\"primary\" class=\"add\" @click=\"addEquip\">水表录入</el-button>\n\n                        \n                    </div>\n                    <p style=\"padding-left:15px;\">当前录入数量：{{item.list.length}}</p>\n                    <el-table\n                    :data=\"item.list\"\n                    @selection-change=\"handleSelectionChange\"\n                    :row-class-name=\"({row})=>row.offline&&'offline'\"\n                    style=\"width: 100%\">\n                        <el-table-column\n                            prop=\"deviceNumber\"\n                            label=\"设备编号\"\n                        >\n                        </el-table-column>\n                        <el-table-column\n                            prop=\"houseNumber\"\n                            label=\"设备位置\"\n                            >\n                        </el-table-column>\n                        <el-table-column\n                            prop=\"setupDatetime\"\n                            label=\"录入时间\"\n                            >\n                        </el-table-column>\n                        <el-table-column\n                        label=\"操作\"\n                        >\n                        <template slot-scope=\"water\" >\n                            <div style=\"text-align:center\" >\n                                <el-button size=\"mini\" type=\"text\" @click=\"deleteWater(item.list,water.row.deviceNumber,water.row,water)\">删除</el-button> <span></span>\n                                <el-button size=\"mini\" type=\"text\" @click=\"$refs.edition.show(water.row)\">详情</el-button>\n\n                            </div>\n                        </template>\n                        </el-table-column>\n                    </el-table>\n                    \n                </el-collapse-item>\n            </el-collapse>\n            <div class=\"origintip\" v-if=\"this.listDate.length==0\">\n                <i class=\"el-icon-warning\"></i>\n                <span>您还未创建虚拟采集器,点击右上角添加创建虚拟采集器</span>\n            </div>\n        </div>\n    </div>\n    <el-dialog\n        title=\"提示\"\n        :visible.sync=\"dialogVisible\"\n        width=\"30%\">\n        <span>请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除</span>\n        <br><br>\n        <div>\n            虚拟采集器ID：{{id}}\n        </div>\n        <div id=\"remarks\">\n            新的设备ID<el-input v-model=\"trueId\" placeholder=\"请输入ID\"></el-input>\n        </div>\n        <span slot=\"footer\" class=\"dialog-footer\">\n            <el-button @click=\"dialogVisible = false\">取 消</el-button>\n            <el-button type=\"primary\" @click =\"confirm(trueId)\">确 定</el-button>\n        </span>\n    </el-dialog>\n\n    <edit ref=\"edition\" ></edit>\n  </div>\n</template>\n\n<script>\n\nconst PAGESIZE = 10  //每页显示数量\n\nimport BScroll from 'better-scroll'\nimport edit from '@/components/list/coloterManage/edit.vue'\nimport {removeStorage} from '@/assets/js/offline.js'\nexport default {\n  components:{\n      edit\n  },\n  props:{},\n  data(){\n    return {\n        activeName:'',\n        freshData:false,\n        marks:\"备注\",\n        id:'',          //当前选择的虚拟设备ID\n        trueId:'',\n        listDate:[],\n        dialogVisible: false,\n        tableData: [],\n        multipleSelection: [],\n        inventSCroll:null,\n        data:[\n            {\"cityId\":383,\"CollectorNum\":\"19110722\",\"consumerUname\":\"\",\"deviceNumber\":\"1509800029\",\"districtDetail\":\"钱江路-\",\"districtId\":3234,\"districtSite\":\"\",\"houseNumber\":\"101\",\"latitude\":30.25924446,\"longitude\":120.21937542,\"provinceId\":31,\"telephone\":\"\",\"type\":3},\n            {\"cityId\":383,\"CollectorNum\":\"19110722\",\"consumerUname\":\"\",\"deviceNumber\":\"1509800068\",\"districtDetail\":\"钱江路-\",\"districtId\":3234,\"districtSite\":\"\",\"houseNumber\":\"102\",\"latitude\":30.25924446,\"longitude\":120.21937542,\"provinceId\":31,\"telephone\":\"\",\"type\":3}\n            ]\n    }\n  },\n  watch:{},\n  computed:{\n      \n  },\n  methods:{\n      handleChange(val){\n          this.id = val\n      },\n      handleSelectionChange(val) {    //选择水表\n        this.multipleSelection = val;\n      },\n      addEquip(){\n          this.$router.push({\n              path:\"/watermeter\",\n              query:{inventedID:this.id}\n              })\n      },\n      offlineSetUp(){\n          this.water.forEach(val=>{\n              val.collectorNum = val.CollectorNum\n          }) \n          this.$confirm('是否导入所有离线设备','提示',{\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            })\n          .then(res=>{\n              if(this.water.length>0){\n                  this.$http.post('/weiXin/api/v1/deviceManager/bashGeneralInstall',\n                      this.water\n                  ,{\n                        'Content-Type': 'application/json;'\n                    },true)\n                  .then(res=>{\n                      if(res){\n                        //   removeStorage('watermeter',this.water)\n                        \n                          if(res.data.data){\n                            localStorage.setItem('watermeter',res.data.data)\n                            this.$message(\n                              {type:'error',message:`${JSON.parse(res.data.data).length}个设备导入失败`}\n                            )\n                          }else{\n                              this.$message(\n                              {type:'success',message:'导入成功'}\n                              )\n                          }\n                          \n                          this.searchData()\n                      }\n                  })\n\n              }else{\n                  this.$message(\n                        {type:'error',message:'暂无离线设备'}\n                    )\n              }\n          })\n          .catch(()=>{\n              \n          })\n          \n      },\n      deleteWater(table,id,row,water){\n        this.$confirm('是否删除水表 ' ,'提示',{\n        confirmButtonText: '确定',\n        cancelButtonText: '取消',\n\t\t})\n\t\t.then(() => {\n            if(row.offline){\n                removeStorage('watermeter',id)\n                table.splice(water.$index,1)\n                this.$message({\n                type: 'success',\n                message: '删除成功!'\n                });\n            }else{\n                this.$http.get('/weiXin/api/v1/deviceMend/deleteDevice',{\n                  deviceNum:id,\n                  deviceType:3\n                })\n                .then(res=>{\n                    \n                    if(res){\n                        table.forEach((item,ind)=>{\n              \n                            if(item.deviceNumber==id){\n                                table.splice(ind,1)\n                            }\n                                \n                        })\n                        this.$message({\n                        type: 'success',\n                        message: '删除成功!'\n                        });\n                    }\n                })\n\n            }\n\n            \n\t\t})\n\t\t.catch(() => {  \n\t\t})\n          \n      },\n      replace(eid,item,index){\n          this.dialogVisible = true\n          this.id = eid\n          this.replaceIndex = index\n      },\n      initScroll(Obj,SCobj){\n          if( !Obj ){\n           Obj = new BScroll(SCobj,{\n               click:true,\n               pullDownRefresh:{\n                threshold: 55,\n                txt:'刷新'\n                },\t\t\t   \n            })\n            Obj.on('pullingDown',()=>{\n                this.searchData()\n                .then(_=>{\n                    Obj.refresh()\n                    Obj.finishPullDown();\n                })\n                    \n             \n            })\n\t\t  }else{\n\t\t\t  Obj.refresh()\n          }\n          \n        },\n      installWater(waterOrign,result){ //返回失败的水表\n          return this.$http.post('/weiXin/api/v1/deviceManager/bashGeneralInstall',result,{\n                'Content-Type': 'application/json;'\n            },true)\n            .then(res=>{\n                if(res){\n                    if(res.data.data){\n                        var errorList = JSON.parse(res.data.data)\n                        errorList.forEach(e=>{\n                            e.CollectorNum = this.id\n                        })\n                       waterOrign=waterOrign.concat(errorList)\n                       localStorage.setItem('watermeter',JSON.stringify(waterOrign))\n                       this.water = waterOrign\n                       return  errorList\n                    }else{\n                        return []\n                    }\n                    \n                }\n            })\n      },\n      setup(){\n          this.$http.get('/weiXin/api/v1/virtualDevice/replaceVirtualCollectorNum',{deviceNumber:this.trueId,virtualCollectorId:this.id})\n            .then(res=>{\n                if(res.data.code==0){\n                    this.$message({\n                            type: 'success',\n                            message: \"替换成功\"\n                        })\n                    this.listDate.splice(this.replaceIndex,1)\n                    this.dialogVisible=false\n                    \n                }else{\n                    this.dialogVisible=false\n                    this.$message({\n                        type: 'error',\n                        message:res.data.message\n                        })\n                }\n            })\n            .catch(err=>{\n                this.dialogVisible=false\n            })\n      },\n      confirm(trueId){\n          if(this.water.length>0){//有离线设备\n                let waterOrign =JSON.parse(JSON.stringify(this.water))//缓存原始数据\n                var result = []\n\n                waterOrign = waterOrign.filter(val=>{//获取其中该采集器下的水表\n                    if(val.CollectorNum == this.id){\n                        result.push(\n                            {\n                            ...val,\n                            \"collectorNum\": this.trueId,\n                            \"type\": 3,\n                            'time':new Date().getTime()\n                            }\n                        ) \n                        return false\n                    }else{\n                        return true\n                    }\n                })\n                if(result.length>0){\n                    this.installWater(waterOrign,result)\n                    .then(meters=>{\n                        if(meters.length == 0){ //没有失败的水表\n                            this.setup()\n                            localStorage.setItem('watermeter',JSON.stringify(waterOrign)) //删除成功的水表并更新            \n                        }else{\n                            this.searchData()\n                            this.$message({\n                                type: 'error',\n                                message: \"部分水表安装失败\"\n                            })\n                            this.dialogVisible=false\n                        }\n                    })\n\n                }\n\n          }else{\n              this.setup()\n          }\n          \n      },\n      remove(id) {\n        this.$confirm('是否删除虚拟机？', '确认信息', {\n          distinguishCancelAndClose: true,\n          confirmButtonText: '确认',\n          cancelButtonText: '取消'\n        })\n          .then(() => {\n              \n            this.$http.get('/weiXin/api/v1/virtualDevice/deleteVirtualCollectorNum',{\n                virtualCollectorId:id\n                }) .then(res=>{\n                if(res.data.code==0){\n                    this.listDate.forEach((val,ind)=>{\n                        if(val.id==id){\n                            this.listDate.splice(ind,1)\n                        }\n                    })\n                    \n                }else if(res.data.code==24){\n                    this.$message({\n                        type:'error',\n                        message:'该设备下仍挂接水表不能删除,请点击替换设备'\n                    })\n                }else{\n                    this.$message({\n                        type:'error',\n                        message:'删除失败'\n                    })\n                }\n            })\n          })\n          .catch(action => {\n            // this.$message({\n            //   type: 'info',\n            //   message: action === 'cancel'\n            //     ? '已取消删除'\n            //     : '删除成功'\n            // })\n          });\n      },\n\n      creatVirtual() {\n        this.$prompt('请输入备注信息', '添加采集器', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            inputValidator:function(res){\n                if(res==null){\n                    return false\n                }\n            },\n            inputErrorMessage:'请输入备注'\n        }).then(({ value }) => {\n            this.$http.get('/weiXin/api/v1/virtualDevice/getVirtualCollectorNum',{remark:value})\n            .then(res=>{\n                if(res.data.code==0){\n                    this.listDate.push({\n                        id:res.data.data,\n                        remark:value,\n                        list:[],\n                        ind:Math.random(10)\n                    })\n\n                }else{\n                    this.$message({\n                        type:'info',\n                        message:'添加失败'\n                    })\n                }\n            })\n        }).catch(() => {\n            // this.$message({\n            // type: 'info',\n            // message: '取消输入'\n            // });       \n        });\n      },\n      //获取数据\n      searchData(){\n        this.water = localStorage.getItem('watermeter')?JSON.parse(localStorage.getItem('watermeter')):[] //缓存的离线水表数据\n        return new Promise(resolve=>{\n            this.freshData=true\n            this.$http.get('/weiXin/api/v1/virtualDevice/getAllVirtualCollectorNum',{\n                pageNum:1,\n                pageSize:200,//懒得做分页\n            })\n            .then(res=>{\n                this.freshData=false\n                \n                let list = res.data.data.map((val,ind)=>{\n                    let list = val.list\n                    this.water&&this.water.forEach(water=>{\n                        if(water.CollectorNum == val.id){\n                            water.offline = true\n                            list.push(water)\n                        }\n                    })\n                    return{\n                    id:val.id,\n                    remark:val.remark,\n                    list:list,\n                    ind:ind\n                }\n                    \n                })\n                this.listDate=list\n                \n                resolve()\n            })\n        })\n      },\n  },\n  created(){\n      this.searchData();\n  },\n  mounted(){\n      \n      this.$nextTick(()=>{\n            this.initScroll(this.inventScroll,this.$refs.inventWrapper);\n        });\n  }\n}\n</script>\n<style  lang=\"less\">\n\n    #invented{\n        .cloWra{\n            height: 78vh;\n            overflow:hidden;\n            >div{\n                min-height: calc(100% + 1px)\n            }\n        }\n        .elist{\n            margin-bottom: 50px;\n            .el-collapse-item__header{\n                height: 40px;\n                line-height: 40px;\n                display: flex;\n                justify-content: space-between;\n                .invtitle{\n                    display: flex;\n                    justify-content: space-between;\n                    padding:0 15px;\n                    width: 90%;\n                    order: -1;\n                    .remove{\n                        color: #b4aeae;\n                        margin: 15px 40px 0 15px;\n                        height: 15px;\n                        padding-left:  15px;\n                        border-left: 1px solid #b8b3b3;\n                    }\n                    .replace{\n                        color: #FC5B3B;\n                        margin: 15px 0px 0 15px;\n                        height: 15px;\n                        padding-left:  15px;\n                    }\n                    \n                }   \n            }\n            .offline{\n                color: red;\n            }\n                \n        }\n        .opera{\n                padding: 0 20px 10px 20px;\n                display: flex;\n                justify-content: flex-end;\n                align-items: center;\n                button{\n                    border:0;\n                }\n                .add{\n                    background: #FC5B3B;\n                }\n            }\n        .item-opera{\n            display: flex;\n            justify-content: space-between;\n            margin: 0 15px;\n            .tip{\n                line-height: 25px;\n                text-align: left;\n                width: 40%;\n                white-space:pre-wrap;\n                word-wrap : break-word ;\n                overflow: hidden ;\n                // padding:0 20px 10px  15px;\n                \n            }\n            button{\n                \n            }\n        }\n        .origintip{\n            margin: 20px;\n            text-align: center;\n            font-size:19px;/* no*/ \n        }\n        .el-collapse-item__content{\n            .opera{\n                margin-top: 20px;\n                padding: 0 20px 0 20px;\n                display: flex;\n                justify-content: space-between;\n                button{\n                    border:0;\n                }\n                .add{\n                    background: #FC5B3B;\n                }\n            }\n        }\n        \n    }\n\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/list/invented/invented.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"invented\"}},[_c('div',{staticClass:\"opera\"},[_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.offlineSetUp}},[_vm._v(\"离线录入\")]),_vm._v(\" \"),_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.creatVirtual}},[_vm._v(\"添加采集器\")])],1),_vm._v(\" \"),_c('div',{ref:\"inventWrapper\",staticClass:\"cloWra\"},[_c('div',[_c('el-collapse',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.freshData),expression:\"freshData\"}],staticClass:\"elist\",attrs:{\"accordion\":\"\"},on:{\"change\":_vm.handleChange},model:{value:(_vm.activeName),callback:function ($$v) {_vm.activeName=$$v},expression:\"activeName\"}},_vm._l((_vm.listDate),function(item,index){return _c('el-collapse-item',{key:item.ind,attrs:{\"name\":item.id}},[_c('template',{attrs:{\"slot\":\"title\"},slot:\"title\"},[_c('div',{staticClass:\"invtitle\"},[_c('p',[_vm._v(\"编号：\"+_vm._s(item.id))]),_vm._v(\" \"),_c('div',[_c('span',{staticClass:\"replace\",on:{\"click\":function($event){$event.stopPropagation();_vm.replace(item.id,item,index)}}},[_vm._v(\"替换\")]),_vm._v(\" \"),_c('span',{staticClass:\"remove\",on:{\"click\":function($event){$event.stopPropagation();_vm.remove(item.id)}}},[_vm._v(\"删除\")])])])]),_vm._v(\" \"),_c('div',{staticClass:\"item-opera\"},[_c('p',{staticClass:\"tip\"},[_vm._v(\"备注：\"+_vm._s(item.remark))]),_vm._v(\" \"),_c('el-button',{staticClass:\"add\",attrs:{\"size\":\"mini\",\"type\":\"primary\"},on:{\"click\":_vm.addEquip}},[_vm._v(\"水表录入\")])],1),_vm._v(\" \"),_c('p',{staticStyle:{\"padding-left\":\"15px\"}},[_vm._v(\"当前录入数量：\"+_vm._s(item.list.length))]),_vm._v(\" \"),_c('el-table',{staticStyle:{\"width\":\"100%\"},attrs:{\"data\":item.list,\"row-class-name\":function (ref){\n\tvar row = ref.row;\n\n\treturn row.offline&&'offline';\n}},on:{\"selection-change\":_vm.handleSelectionChange}},[_c('el-table-column',{attrs:{\"prop\":\"deviceNumber\",\"label\":\"设备编号\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"houseNumber\",\"label\":\"设备位置\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"prop\":\"setupDatetime\",\"label\":\"录入时间\"}}),_vm._v(\" \"),_c('el-table-column',{attrs:{\"label\":\"操作\"},scopedSlots:_vm._u([{key:\"default\",fn:function(water){return [_c('div',{staticStyle:{\"text-align\":\"center\"}},[_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"text\"},on:{\"click\":function($event){_vm.deleteWater(item.list,water.row.deviceNumber,water.row,water)}}},[_vm._v(\"删除\")]),_vm._v(\" \"),_c('span'),_vm._v(\" \"),_c('el-button',{attrs:{\"size\":\"mini\",\"type\":\"text\"},on:{\"click\":function($event){_vm.$refs.edition.show(water.row)}}},[_vm._v(\"详情\")])],1)]}}])})],1)],2)})),_vm._v(\" \"),(this.listDate.length==0)?_c('div',{staticClass:\"origintip\"},[_c('i',{staticClass:\"el-icon-warning\"}),_vm._v(\" \"),_c('span',[_vm._v(\"您还未创建虚拟采集器,点击右上角添加创建虚拟采集器\")])]):_vm._e()],1)]),_vm._v(\" \"),_c('el-dialog',{attrs:{\"title\":\"提示\",\"visible\":_vm.dialogVisible,\"width\":\"30%\"},on:{\"update:visible\":function($event){_vm.dialogVisible=$event}}},[_c('span',[_vm._v(\"请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除\")]),_vm._v(\" \"),_c('br'),_c('br'),_vm._v(\" \"),_c('div',[_vm._v(\"\\n          虚拟采集器ID：\"+_vm._s(_vm.id)+\"\\n      \")]),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"remarks\"}},[_vm._v(\"\\n          新的设备ID\"),_c('el-input',{attrs:{\"placeholder\":\"请输入ID\"},model:{value:(_vm.trueId),callback:function ($$v) {_vm.trueId=$$v},expression:\"trueId\"}})],1),_vm._v(\" \"),_c('span',{staticClass:\"dialog-footer\",attrs:{\"slot\":\"footer\"},slot:\"footer\"},[_c('el-button',{on:{\"click\":function($event){_vm.dialogVisible = false}}},[_vm._v(\"取 消\")]),_vm._v(\" \"),_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":function($event){_vm.confirm(_vm.trueId)}}},[_vm._v(\"确 定\")])],1)]),_vm._v(\" \"),_c('edit',{ref:\"edition\"})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-630dbe72\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/list/invented/invented.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true,\\\"publicPath\\\":\\\"../../\\\"}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-630dbe72\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":true}!less-loader?{\\\"sourceMap\\\":true}!../../../../node_modules/vue-loader/lib/selector?type=styles&index=0!./invented.vue\")\n}\nvar normalizeComponent = require(\"!../../../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nimport __vue_script__ from \"!!babel-loader!../../../../node_modules/vue-loader/lib/selector?type=script&index=0!./invented.vue\"\n/* template */\nimport __vue_template__ from \"!!../../../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-630dbe72\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../../../node_modules/vue-loader/lib/selector?type=template&index=0!./invented.vue\"\n/* template functional */\n  var __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/list/invented/invented.vue\n// module id = null\n// module chunks = "],"sourceRoot":""}