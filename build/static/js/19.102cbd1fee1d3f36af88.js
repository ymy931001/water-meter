webpackJsonp([19],{"21vz":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("rVsN"),n=i.n(a),s=i("4YfN"),r=i.n(s),l=i("3cXf"),o=i.n(l),c=i("YUvS"),u=i("hhiW"),d=i("qn9g"),p={components:{edit:u.a},props:{},data:function(){return{activeName:"",freshData:!1,marks:"备注",id:"",trueId:"",listDate:[],dialogVisible:!1,tableData:[],multipleSelection:[],inventSCroll:null,data:[{cityId:383,CollectorNum:"19110722",consumerUname:"",deviceNumber:"1509800029",districtDetail:"钱江路-",districtId:3234,districtSite:"",houseNumber:"101",latitude:30.25924446,longitude:120.21937542,provinceId:31,telephone:"",type:3},{cityId:383,CollectorNum:"19110722",consumerUname:"",deviceNumber:"1509800068",districtDetail:"钱江路-",districtId:3234,districtSite:"",houseNumber:"102",latitude:30.25924446,longitude:120.21937542,provinceId:31,telephone:"",type:3}]}},watch:{},computed:{},methods:{handleChange:function(t){this.id=t},handleSelectionChange:function(t){this.multipleSelection=t},addEquip:function(){this.$router.push({path:"/watermeter",query:{inventedID:this.id}})},offlineSetUp:function(){var t=this;this.water.forEach(function(t){t.collectorNum=t.CollectorNum}),this.$confirm("是否导入所有离线设备","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(e){t.water.length>0?t.$http.post("/weiXin/api/v1/deviceManager/bashGeneralInstall",t.water,{"Content-Type":"application/json;"},!0).then(function(e){e&&(e.data.data?(localStorage.setItem("watermeter",e.data.data),t.$message({type:"success",message:JSON.parse(e.data.data).length+"个设备导入失败"})):t.$message({type:"success",message:"导入成功"}),t.searchData())}):t.$message({type:"error",message:"暂无离线设备"})}).catch(function(){})},deleteWater:function(t,e,i,a){var n=this;this.$confirm("是否删除水表 ","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){i.offline?(Object(d.c)("watermeter",e),t.splice(a.$index,1),n.$message({type:"success",message:"删除成功!"})):n.$http.get("/weiXin/api/v1/deviceMend/deleteDevice",{deviceNum:e,deviceType:3}).then(function(i){i&&(t.forEach(function(i,a){i.deviceNumber==e&&t.splice(a,1)}),n.$message({type:"success",message:"删除成功!"}))})}).catch(function(){})},replace:function(t,e,i){this.dialogVisible=!0,this.id=t,this.replaceIndex=i},initScroll:function(t,e){var i=this;t?t.refresh():(t=new c.default(e,{click:!0,pullDownRefresh:{threshold:55,txt:"刷新"}})).on("pullingDown",function(){i.searchData().then(function(e){t.refresh(),t.finishPullDown()})})},installWater:function(t,e){var i=this;return this.$http.post("/weiXin/api/v1/deviceManager/bashGeneralInstall",e,{"Content-Type":"application/json;"},!0).then(function(e){if(e){if(e.data.data){var a=JSON.parse(e.data.data);return a.forEach(function(t){t.CollectorNum=i.id}),t=t.concat(a),localStorage.setItem("watermeter",o()(t)),i.water=t,a}return[]}})},setup:function(){var t=this;this.$http.get("/weiXin/api/v1/virtualDevice/replaceVirtualCollectorNum",{deviceNumber:this.trueId,virtualCollectorId:this.id}).then(function(e){0==e.data.code?(t.$message({type:"success",message:"替换成功"}),t.listDate.splice(t.replaceIndex,1),t.dialogVisible=!1):(t.dialogVisible=!1,t.$message({type:"error",message:e.data.message}))}).catch(function(e){t.dialogVisible=!1})},confirm:function(t){var e=this;if(this.water.length>0){var i=JSON.parse(o()(this.water)),a=[];i=i.filter(function(t){return t.CollectorNum!=e.id||(a.push(r()({},t,{collectorNum:e.trueId,type:3,time:(new Date).getTime()})),!1)}),a.length>0&&this.installWater(i,a).then(function(t){0==t.length?(e.setup(),localStorage.setItem("watermeter",o()(i))):(e.searchData(),e.$message({type:"error",message:"部分水表安装失败"}),e.dialogVisible=!1)})}else this.setup()},remove:function(t){var e=this;this.$confirm("是否删除虚拟机？","确认信息",{distinguishCancelAndClose:!0,confirmButtonText:"确认",cancelButtonText:"取消"}).then(function(){e.$http.get("/weiXin/api/v1/virtualDevice/deleteVirtualCollectorNum",{virtualCollectorId:t}).then(function(i){0==i.data.code?e.listDate.forEach(function(i,a){i.id==t&&e.listDate.splice(a,1)}):24==i.data.code?e.$message({type:"error",message:"该设备下仍挂接水表不能删除,请点击替换设备"}):e.$message({type:"error",message:"删除失败"})})}).catch(function(t){})},creatVirtual:function(){var t=this;this.$prompt("请输入备注信息","添加采集器",{confirmButtonText:"确定",cancelButtonText:"取消",inputValidator:function(t){if(null==t)return!1},inputErrorMessage:"请输入备注"}).then(function(e){var i=e.value;t.$http.get("/weiXin/api/v1/virtualDevice/getVirtualCollectorNum",{remark:i}).then(function(e){0==e.data.code?t.listDate.push({id:e.data.data,remark:i,list:[],ind:Math.random(10)}):t.$message({type:"info",message:"添加失败"})})}).catch(function(){})},searchData:function(){var t=this;return this.water=localStorage.getItem("watermeter")?JSON.parse(localStorage.getItem("watermeter")):[],new n.a(function(e){t.freshData=!0,t.$http.get("/weiXin/api/v1/virtualDevice/getAllVirtualCollectorNum",{pageNum:1,pageSize:200}).then(function(i){t.freshData=!1;var a=i.data.data.map(function(e,i){var a=e.list;return t.water&&t.water.forEach(function(t){t.CollectorNum==e.id&&(t.offline=!0,a.push(t))}),{id:e.id,remark:e.remark,list:a,ind:i}});t.listDate=a,e()})})}},created:function(){this.searchData()},mounted:function(){var t=this;this.$nextTick(function(){t.initScroll(t.inventScroll,t.$refs.inventWrapper)})}},v={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"invented"}},[i("div",{staticClass:"opera"},[i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.offlineSetUp}},[t._v("离线录入")]),t._v(" "),i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.creatVirtual}},[t._v("添加采集器")])],1),t._v(" "),i("div",{ref:"inventWrapper",staticClass:"cloWra"},[i("div",[i("el-collapse",{directives:[{name:"loading",rawName:"v-loading",value:t.freshData,expression:"freshData"}],staticClass:"elist",attrs:{accordion:""},on:{change:t.handleChange},model:{value:t.activeName,callback:function(e){t.activeName=e},expression:"activeName"}},t._l(t.listDate,function(e,a){return i("el-collapse-item",{key:e.ind,attrs:{name:e.id}},[i("template",{attrs:{slot:"title"},slot:"title"},[i("div",{staticClass:"invtitle"},[i("p",[t._v("编号："+t._s(e.id))]),t._v(" "),i("div",[i("span",{staticClass:"replace",on:{click:function(i){i.stopPropagation(),t.replace(e.id,e,a)}}},[t._v("替换")]),t._v(" "),i("span",{staticClass:"remove",on:{click:function(i){i.stopPropagation(),t.remove(e.id)}}},[t._v("删除")])])])]),t._v(" "),i("div",{staticClass:"item-opera"},[i("p",{staticClass:"tip"},[t._v("备注："+t._s(e.remark))]),t._v(" "),i("el-button",{staticClass:"add",attrs:{size:"mini",type:"primary"},on:{click:t.addEquip}},[t._v("水表录入")])],1),t._v(" "),i("p",{staticStyle:{"padding-left":"15px"}},[t._v("当前录入数量："+t._s(e.list.length))]),t._v(" "),i("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list,"row-class-name":function(t){return t.row.offline&&"offline"}},on:{"selection-change":t.handleSelectionChange}},[i("el-table-column",{attrs:{prop:"deviceNumber",label:"设备编号"}}),t._v(" "),i("el-table-column",{attrs:{prop:"houseNumber",label:"设备位置"}}),t._v(" "),i("el-table-column",{attrs:{prop:"setupDatetime",label:"录入时间"}}),t._v(" "),i("el-table-column",{attrs:{label:"操作"},scopedSlots:t._u([{key:"default",fn:function(a){return[i("div",{staticStyle:{"text-align":"center"}},[i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(i){t.deleteWater(e.list,a.row.deviceNumber,a.row,a)}}},[t._v("删除")]),t._v(" "),i("span"),t._v(" "),i("el-button",{attrs:{size:"mini",type:"text"},on:{click:function(e){t.$refs.edition.show(a.row)}}},[t._v("详情")])],1)]}}])})],1)],2)})),t._v(" "),0==this.listDate.length?i("div",{staticClass:"origintip"},[i("i",{staticClass:"el-icon-warning"}),t._v(" "),i("span",[t._v("您还未创建虚拟采集器,点击右上角添加创建虚拟采集器")])]):t._e()],1)]),t._v(" "),i("el-dialog",{attrs:{title:"提示",visible:t.dialogVisible,width:"30%"},on:{"update:visible":function(e){t.dialogVisible=e}}},[i("span",[t._v("请输入新的设备ID,点击确认替换成功后,该虚拟采集器将被删除")]),t._v(" "),i("br"),i("br"),t._v(" "),i("div",[t._v("\n          虚拟采集器ID："+t._s(t.id)+"\n      ")]),t._v(" "),i("div",{attrs:{id:"remarks"}},[t._v("\n          新的设备ID"),i("el-input",{attrs:{placeholder:"请输入ID"},model:{value:t.trueId,callback:function(e){t.trueId=e},expression:"trueId"}})],1),t._v(" "),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取 消")]),t._v(" "),i("el-button",{attrs:{type:"primary"},on:{click:function(e){t.confirm(t.trueId)}}},[t._v("确 定")])],1)]),t._v(" "),i("edit",{ref:"edition"})],1)},staticRenderFns:[]};var h=i("46Yf")(p,v,!1,function(t){i("nKp2")},null,null);e.default=h.exports},nKp2:function(t,e){}});
//# sourceMappingURL=19.102cbd1fee1d3f36af88.js.map